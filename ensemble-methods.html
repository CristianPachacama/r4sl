<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R for Statistical Learning</title>
  <meta name="description" content="<code>R</code> for Statistical Learning">
  <meta name="generator" content="bookdown 0.5.2 and GitBook 2.6.7">

  <meta property="og:title" content="R for Statistical Learning" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://daviddalpiaz.github.io/r4sl/" />
  
  
  <meta name="github-repo" content="daviddalpiaz/r4sl" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R for Statistical Learning" />
  
  
  

<meta name="author" content="David Dalpiaz">


<meta name="date" content="2017-10-04">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="prev" href="trees.html">
<link rel="next" href="artificial-neural-networks.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Statistical Learning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i>About This Book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#organization"><i class="fa fa-check"></i>Organization</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who"><i class="fa fa-check"></i>Who?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caveat-emptor"><i class="fa fa-check"></i>Caveat Emptor</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="part"><span><b>I Prerequisites</b></span></li>
<li class="chapter" data-level="1" data-path="prerequisites-overview.html"><a href="prerequisites-overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="probability-review.html"><a href="probability-review.html"><i class="fa fa-check"></i><b>2</b> Probability Review</a><ul>
<li class="chapter" data-level="2.1" data-path="probability-review.html"><a href="probability-review.html#probability-models"><i class="fa fa-check"></i><b>2.1</b> Probability Models</a></li>
<li class="chapter" data-level="2.2" data-path="probability-review.html"><a href="probability-review.html#probability-axioms"><i class="fa fa-check"></i><b>2.2</b> Probability Axioms</a></li>
<li class="chapter" data-level="2.3" data-path="probability-review.html"><a href="probability-review.html#probability-rules"><i class="fa fa-check"></i><b>2.3</b> Probability Rules</a></li>
<li class="chapter" data-level="2.4" data-path="probability-review.html"><a href="probability-review.html#random-variables"><i class="fa fa-check"></i><b>2.4</b> Random Variables</a><ul>
<li class="chapter" data-level="2.4.1" data-path="probability-review.html"><a href="probability-review.html#distributions"><i class="fa fa-check"></i><b>2.4.1</b> Distributions</a></li>
<li class="chapter" data-level="2.4.2" data-path="probability-review.html"><a href="probability-review.html#discrete-random-variables"><i class="fa fa-check"></i><b>2.4.2</b> Discrete Random Variables</a></li>
<li class="chapter" data-level="2.4.3" data-path="probability-review.html"><a href="probability-review.html#continuous-random-variables"><i class="fa fa-check"></i><b>2.4.3</b> Continuous Random Variables</a></li>
<li class="chapter" data-level="2.4.4" data-path="probability-review.html"><a href="probability-review.html#several-random-variables"><i class="fa fa-check"></i><b>2.4.4</b> Several Random Variables</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="probability-review.html"><a href="probability-review.html#expectations"><i class="fa fa-check"></i><b>2.5</b> Expectations</a></li>
<li class="chapter" data-level="2.6" data-path="probability-review.html"><a href="probability-review.html#likelihood"><i class="fa fa-check"></i><b>2.6</b> Likelihood</a></li>
<li class="chapter" data-level="2.7" data-path="probability-review.html"><a href="probability-review.html#videos"><i class="fa fa-check"></i><b>2.7</b> Videos</a></li>
<li class="chapter" data-level="2.8" data-path="probability-review.html"><a href="probability-review.html#references"><i class="fa fa-check"></i><b>2.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-rstudio-rmarkdown.html"><a href="r-rstudio-rmarkdown.html"><i class="fa fa-check"></i><b>3</b> <code>R</code>, RStudio, RMarkdown</a><ul>
<li class="chapter" data-level="3.1" data-path="r-rstudio-rmarkdown.html"><a href="r-rstudio-rmarkdown.html#videos-1"><i class="fa fa-check"></i><b>3.1</b> Videos</a></li>
<li class="chapter" data-level="3.2" data-path="r-rstudio-rmarkdown.html"><a href="r-rstudio-rmarkdown.html#template"><i class="fa fa-check"></i><b>3.2</b> Template</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html"><i class="fa fa-check"></i><b>4</b> Modeling Basics in <code>R</code></a><ul>
<li class="chapter" data-level="4.1" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#visualization-for-regression"><i class="fa fa-check"></i><b>4.1</b> Visualization for Regression</a></li>
<li class="chapter" data-level="4.2" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#the-lm-function"><i class="fa fa-check"></i><b>4.2</b> The <code>lm()</code> Function</a></li>
<li class="chapter" data-level="4.3" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#hypothesis-testing"><i class="fa fa-check"></i><b>4.3</b> Hypothesis Testing</a></li>
<li class="chapter" data-level="4.4" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#prediction"><i class="fa fa-check"></i><b>4.4</b> Prediction</a></li>
<li class="chapter" data-level="4.5" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#unusual-observations"><i class="fa fa-check"></i><b>4.5</b> Unusual Observations</a></li>
<li class="chapter" data-level="4.6" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#adding-complexity"><i class="fa fa-check"></i><b>4.6</b> Adding Complexity</a><ul>
<li class="chapter" data-level="4.6.1" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#interactions"><i class="fa fa-check"></i><b>4.6.1</b> Interactions</a></li>
<li class="chapter" data-level="4.6.2" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#polynomials"><i class="fa fa-check"></i><b>4.6.2</b> Polynomials</a></li>
<li class="chapter" data-level="4.6.3" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#transformations"><i class="fa fa-check"></i><b>4.6.3</b> Transformations</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#rmarkdown"><i class="fa fa-check"></i><b>4.7</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="part"><span><b>II Regression</b></span></li>
<li class="chapter" data-level="5" data-path="regression-overview.html"><a href="regression-overview.html"><i class="fa fa-check"></i><b>5</b> Overview</a><ul>
<li class="chapter" data-level="5.1" data-path="regression-overview.html"><a href="regression-overview.html#regression-notation"><i class="fa fa-check"></i><b>5.1</b> Regression Notation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="linear-models.html"><a href="linear-models.html"><i class="fa fa-check"></i><b>6</b> Linear Models</a><ul>
<li class="chapter" data-level="6.1" data-path="linear-models.html"><a href="linear-models.html#assesing-model-accuracy"><i class="fa fa-check"></i><b>6.1</b> Assesing Model Accuracy</a></li>
<li class="chapter" data-level="6.2" data-path="linear-models.html"><a href="linear-models.html#model-complexity"><i class="fa fa-check"></i><b>6.2</b> Model Complexity</a></li>
<li class="chapter" data-level="6.3" data-path="linear-models.html"><a href="linear-models.html#test-train-split"><i class="fa fa-check"></i><b>6.3</b> Test-Train Split</a></li>
<li class="chapter" data-level="6.4" data-path="linear-models.html"><a href="linear-models.html#adding-flexibility-to-linear-models"><i class="fa fa-check"></i><b>6.4</b> Adding Flexibility to Linear Models</a></li>
<li class="chapter" data-level="6.5" data-path="linear-models.html"><a href="linear-models.html#choosing-a-model"><i class="fa fa-check"></i><b>6.5</b> Choosing a Model</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="knn-reg.html"><a href="knn-reg.html"><i class="fa fa-check"></i><b>7</b> <span class="math inline">\(k\)</span>-Nearest Neighbors</a><ul>
<li class="chapter" data-level="7.1" data-path="knn-reg.html"><a href="knn-reg.html#parametric-versus-non-parametric-models"><i class="fa fa-check"></i><b>7.1</b> Parametric versus Non-Parametric Models</a></li>
<li class="chapter" data-level="7.2" data-path="knn-reg.html"><a href="knn-reg.html#local-approaches"><i class="fa fa-check"></i><b>7.2</b> Local Approaches</a><ul>
<li class="chapter" data-level="7.2.1" data-path="knn-reg.html"><a href="knn-reg.html#neighbors"><i class="fa fa-check"></i><b>7.2.1</b> Neighbors</a></li>
<li class="chapter" data-level="7.2.2" data-path="knn-reg.html"><a href="knn-reg.html#neighborhoods"><i class="fa fa-check"></i><b>7.2.2</b> Neighborhoods</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="knn-reg.html"><a href="knn-reg.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>7.3</b> <span class="math inline">\(k\)</span>-Nearest Neighbors</a></li>
<li class="chapter" data-level="7.4" data-path="knn-reg.html"><a href="knn-reg.html#tuning-parameters-versus-model-parameters"><i class="fa fa-check"></i><b>7.4</b> Tuning Parameters versus Model Parameters</a></li>
<li class="chapter" data-level="7.5" data-path="knn-reg.html"><a href="knn-reg.html#knn-in-r"><i class="fa fa-check"></i><b>7.5</b> KNN in <code>R</code></a></li>
<li class="chapter" data-level="7.6" data-path="knn-reg.html"><a href="knn-reg.html#choosing-k"><i class="fa fa-check"></i><b>7.6</b> Choosing <span class="math inline">\(k\)</span></a></li>
<li class="chapter" data-level="7.7" data-path="knn-reg.html"><a href="knn-reg.html#linear-versus-non-linear"><i class="fa fa-check"></i><b>7.7</b> Linear versus Non-Linear</a></li>
<li class="chapter" data-level="7.8" data-path="knn-reg.html"><a href="knn-reg.html#scaling-data"><i class="fa fa-check"></i><b>7.8</b> Scaling Data</a></li>
<li class="chapter" data-level="7.9" data-path="knn-reg.html"><a href="knn-reg.html#curse-of-dimensionality"><i class="fa fa-check"></i><b>7.9</b> Curse of Dimensionality</a></li>
<li class="chapter" data-level="7.10" data-path="knn-reg.html"><a href="knn-reg.html#train-time-versus-test-time"><i class="fa fa-check"></i><b>7.10</b> Train Time versus Test Time</a></li>
<li class="chapter" data-level="7.11" data-path="knn-reg.html"><a href="knn-reg.html#interpretability"><i class="fa fa-check"></i><b>7.11</b> Interpretability</a></li>
<li class="chapter" data-level="7.12" data-path="knn-reg.html"><a href="knn-reg.html#data-example"><i class="fa fa-check"></i><b>7.12</b> Data Example</a></li>
<li class="chapter" data-level="7.13" data-path="knn-reg.html"><a href="knn-reg.html#rmarkdown-1"><i class="fa fa-check"></i><b>7.13</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="biasvariance-tradeoff.html"><a href="biasvariance-tradeoff.html"><i class="fa fa-check"></i><b>8</b> Bias–Variance Tradeoff</a><ul>
<li class="chapter" data-level="8.1" data-path="biasvariance-tradeoff.html"><a href="biasvariance-tradeoff.html#reducible-and-irreducible-error"><i class="fa fa-check"></i><b>8.1</b> Reducible and Irreducible Error</a></li>
<li class="chapter" data-level="8.2" data-path="biasvariance-tradeoff.html"><a href="biasvariance-tradeoff.html#bias-variance-decomposition"><i class="fa fa-check"></i><b>8.2</b> Bias-Variance Decomposition</a></li>
<li class="chapter" data-level="8.3" data-path="biasvariance-tradeoff.html"><a href="biasvariance-tradeoff.html#simulation"><i class="fa fa-check"></i><b>8.3</b> Simulation</a></li>
<li class="chapter" data-level="8.4" data-path="biasvariance-tradeoff.html"><a href="biasvariance-tradeoff.html#estimating-expected-prediction-error"><i class="fa fa-check"></i><b>8.4</b> Estimating Expected Prediction Error</a></li>
<li class="chapter" data-level="8.5" data-path="biasvariance-tradeoff.html"><a href="biasvariance-tradeoff.html#rmarkdown-2"><i class="fa fa-check"></i><b>8.5</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="part"><span><b>III Classification</b></span></li>
<li class="chapter" data-level="9" data-path="classification-overview.html"><a href="classification-overview.html"><i class="fa fa-check"></i><b>9</b> Overview</a><ul>
<li class="chapter" data-level="9.1" data-path="classification-overview.html"><a href="classification-overview.html#visualization-for-classification"><i class="fa fa-check"></i><b>9.1</b> Visualization for Classification</a></li>
<li class="chapter" data-level="9.2" data-path="classification-overview.html"><a href="classification-overview.html#a-simple-classifier"><i class="fa fa-check"></i><b>9.2</b> A Simple Classifier</a></li>
<li class="chapter" data-level="9.3" data-path="classification-overview.html"><a href="classification-overview.html#metrics-for-classification"><i class="fa fa-check"></i><b>9.3</b> Metrics for Classification</a></li>
<li class="chapter" data-level="9.4" data-path="classification-overview.html"><a href="classification-overview.html#rmarkdown-3"><i class="fa fa-check"></i><b>9.4</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>10</b> Logistic Regression</a><ul>
<li class="chapter" data-level="10.1" data-path="logistic-regression.html"><a href="logistic-regression.html#linear-regression"><i class="fa fa-check"></i><b>10.1</b> Linear Regression</a></li>
<li class="chapter" data-level="10.2" data-path="logistic-regression.html"><a href="logistic-regression.html#bayes-classifier"><i class="fa fa-check"></i><b>10.2</b> Bayes Classifier</a></li>
<li class="chapter" data-level="10.3" data-path="logistic-regression.html"><a href="logistic-regression.html#logistic-regression-with-glm"><i class="fa fa-check"></i><b>10.3</b> Logistic Regression with <code>glm()</code></a></li>
<li class="chapter" data-level="10.4" data-path="logistic-regression.html"><a href="logistic-regression.html#roc-curves"><i class="fa fa-check"></i><b>10.4</b> ROC Curves</a></li>
<li class="chapter" data-level="10.5" data-path="logistic-regression.html"><a href="logistic-regression.html#multinomial-logistic-regression"><i class="fa fa-check"></i><b>10.5</b> Multinomial Logistic Regression</a></li>
<li class="chapter" data-level="10.6" data-path="logistic-regression.html"><a href="logistic-regression.html#rmarkdown-4"><i class="fa fa-check"></i><b>10.6</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="generative-models.html"><a href="generative-models.html"><i class="fa fa-check"></i><b>11</b> Generative Models</a><ul>
<li class="chapter" data-level="11.1" data-path="generative-models.html"><a href="generative-models.html#linear-discriminant-analysis"><i class="fa fa-check"></i><b>11.1</b> Linear Discriminant Analysis</a></li>
<li class="chapter" data-level="11.2" data-path="generative-models.html"><a href="generative-models.html#quadratic-discriminant-analysis"><i class="fa fa-check"></i><b>11.2</b> Quadratic Discriminant Analysis</a></li>
<li class="chapter" data-level="11.3" data-path="generative-models.html"><a href="generative-models.html#naive-bayes"><i class="fa fa-check"></i><b>11.3</b> Naive Bayes</a></li>
<li class="chapter" data-level="11.4" data-path="generative-models.html"><a href="generative-models.html#discrete-inputs"><i class="fa fa-check"></i><b>11.4</b> Discrete Inputs</a></li>
<li class="chapter" data-level="11.5" data-path="generative-models.html"><a href="generative-models.html#rmarkdown-5"><i class="fa fa-check"></i><b>11.5</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="knn-class.html"><a href="knn-class.html"><i class="fa fa-check"></i><b>12</b> k-Nearest Neighbors</a><ul>
<li class="chapter" data-level="12.1" data-path="knn-class.html"><a href="knn-class.html#binary-data-example"><i class="fa fa-check"></i><b>12.1</b> Binary Data Example</a></li>
<li class="chapter" data-level="12.2" data-path="knn-class.html"><a href="knn-class.html#categorical-data"><i class="fa fa-check"></i><b>12.2</b> Categorical Data</a></li>
<li class="chapter" data-level="12.3" data-path="knn-class.html"><a href="knn-class.html#external-links"><i class="fa fa-check"></i><b>12.3</b> External Links</a></li>
<li class="chapter" data-level="12.4" data-path="knn-class.html"><a href="knn-class.html#rmarkdown-6"><i class="fa fa-check"></i><b>12.4</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="part"><span><b>IV Unsupervised Learning</b></span></li>
<li class="chapter" data-level="13" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html"><i class="fa fa-check"></i><b>13</b> Overview</a><ul>
<li class="chapter" data-level="13.1" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#methods"><i class="fa fa-check"></i><b>13.1</b> Methods</a><ul>
<li class="chapter" data-level="13.1.1" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#principal-component-analysis"><i class="fa fa-check"></i><b>13.1.1</b> Principal Component Analysis</a></li>
<li class="chapter" data-level="13.1.2" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#k-means-clustering"><i class="fa fa-check"></i><b>13.1.2</b> <span class="math inline">\(k\)</span>-Means Clustering</a></li>
<li class="chapter" data-level="13.1.3" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#hierarchical-clustering"><i class="fa fa-check"></i><b>13.1.3</b> Hierarchical Clustering</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#examples"><i class="fa fa-check"></i><b>13.2</b> Examples</a><ul>
<li class="chapter" data-level="13.2.1" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#us-arrests"><i class="fa fa-check"></i><b>13.2.1</b> US Arrests</a></li>
<li class="chapter" data-level="13.2.2" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#simulated-data"><i class="fa fa-check"></i><b>13.2.2</b> Simulated Data</a></li>
<li class="chapter" data-level="13.2.3" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#iris-data"><i class="fa fa-check"></i><b>13.2.3</b> Iris Data</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#external-links-1"><i class="fa fa-check"></i><b>13.3</b> External Links</a></li>
<li class="chapter" data-level="13.4" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#rmarkdown-7"><i class="fa fa-check"></i><b>13.4</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="principal-component-analysis-1.html"><a href="principal-component-analysis-1.html"><i class="fa fa-check"></i><b>14</b> Principal Component Analysis</a></li>
<li class="chapter" data-level="15" data-path="k-means.html"><a href="k-means.html"><i class="fa fa-check"></i><b>15</b> k-Means</a></li>
<li class="chapter" data-level="16" data-path="mixture-models.html"><a href="mixture-models.html"><i class="fa fa-check"></i><b>16</b> Mixture Models</a></li>
<li class="chapter" data-level="17" data-path="hierarchical-clustering-1.html"><a href="hierarchical-clustering-1.html"><i class="fa fa-check"></i><b>17</b> Hierarchical Clustering</a></li>
<li class="part"><span><b>V In Practice</b></span></li>
<li class="chapter" data-level="18" data-path="practice-overview.html"><a href="practice-overview.html"><i class="fa fa-check"></i><b>18</b> Overview</a></li>
<li class="chapter" data-level="19" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html"><i class="fa fa-check"></i><b>19</b> Supervised Learning Overview</a><ul>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#bayes-classifier-1"><i class="fa fa-check"></i>Bayes Classifier</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#the-bias-variance-tradeoff"><i class="fa fa-check"></i>The Bias-Variance Tradeoff</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#the-test-train-split"><i class="fa fa-check"></i>The Test-Train Split</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#classification-methods"><i class="fa fa-check"></i>Classification Methods</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#discriminative-versus-generative-methods"><i class="fa fa-check"></i>Discriminative versus Generative Methods</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#parametric-and-non-parametric-methods"><i class="fa fa-check"></i>Parametric and Non-Parametric Methods</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#tuning-parameters"><i class="fa fa-check"></i>Tuning Parameters</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#cross-validation"><i class="fa fa-check"></i>Cross-Validation</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#curse-of-dimensionality-1"><i class="fa fa-check"></i>Curse of Dimensionality</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#no-free-lunch-theorem"><i class="fa fa-check"></i>No-Free-Lunch Theorem</a></li>
<li class="chapter" data-level="19.1" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#external-links-2"><i class="fa fa-check"></i><b>19.1</b> External Links</a></li>
<li class="chapter" data-level="19.2" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#rmarkdown-8"><i class="fa fa-check"></i><b>19.2</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="resampling.html"><a href="resampling.html"><i class="fa fa-check"></i><b>20</b> Resampling</a><ul>
<li class="chapter" data-level="20.1" data-path="resampling.html"><a href="resampling.html#test-train-split-1"><i class="fa fa-check"></i><b>20.1</b> Test-Train Split</a></li>
<li class="chapter" data-level="20.2" data-path="resampling.html"><a href="resampling.html#cross-validation-1"><i class="fa fa-check"></i><b>20.2</b> Cross-Validation</a><ul>
<li class="chapter" data-level="20.2.1" data-path="resampling.html"><a href="resampling.html#method-specific"><i class="fa fa-check"></i><b>20.2.1</b> Method Specific</a></li>
<li class="chapter" data-level="20.2.2" data-path="resampling.html"><a href="resampling.html#manual-cross-validation"><i class="fa fa-check"></i><b>20.2.2</b> Manual Cross-Validation</a></li>
<li class="chapter" data-level="20.2.3" data-path="resampling.html"><a href="resampling.html#test-data"><i class="fa fa-check"></i><b>20.2.3</b> Test Data</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="resampling.html"><a href="resampling.html#bootstrap"><i class="fa fa-check"></i><b>20.3</b> Bootstrap</a></li>
<li class="chapter" data-level="20.4" data-path="resampling.html"><a href="resampling.html#external-links-3"><i class="fa fa-check"></i><b>20.4</b> External Links</a></li>
<li class="chapter" data-level="20.5" data-path="resampling.html"><a href="resampling.html#rmarkdown-9"><i class="fa fa-check"></i><b>20.5</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="the-caret-package.html"><a href="the-caret-package.html"><i class="fa fa-check"></i><b>21</b> The <code>caret</code> Package</a><ul>
<li class="chapter" data-level="21.1" data-path="the-caret-package.html"><a href="the-caret-package.html#external-links-4"><i class="fa fa-check"></i><b>21.1</b> External Links</a></li>
<li class="chapter" data-level="21.2" data-path="the-caret-package.html"><a href="the-caret-package.html#rmarkdown-10"><i class="fa fa-check"></i><b>21.2</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="subset-selection.html"><a href="subset-selection.html"><i class="fa fa-check"></i><b>22</b> Subset Selection</a><ul>
<li class="chapter" data-level="22.1" data-path="subset-selection.html"><a href="subset-selection.html#aic-bic-and-cp"><i class="fa fa-check"></i><b>22.1</b> AIC, BIC, and Cp</a><ul>
<li class="chapter" data-level="22.1.1" data-path="subset-selection.html"><a href="subset-selection.html#leaps-package"><i class="fa fa-check"></i><b>22.1.1</b> <code>leaps</code> Package</a></li>
<li class="chapter" data-level="22.1.2" data-path="subset-selection.html"><a href="subset-selection.html#best-subset"><i class="fa fa-check"></i><b>22.1.2</b> Best Subset</a></li>
<li class="chapter" data-level="22.1.3" data-path="subset-selection.html"><a href="subset-selection.html#stepwise-methods"><i class="fa fa-check"></i><b>22.1.3</b> Stepwise Methods</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="subset-selection.html"><a href="subset-selection.html#validated-rmse"><i class="fa fa-check"></i><b>22.2</b> Validated RMSE</a></li>
<li class="chapter" data-level="22.3" data-path="subset-selection.html"><a href="subset-selection.html#external-links-5"><i class="fa fa-check"></i><b>22.3</b> External Links</a></li>
<li class="chapter" data-level="22.4" data-path="subset-selection.html"><a href="subset-selection.html#rmarkdown-11"><i class="fa fa-check"></i><b>22.4</b> RMarkdown</a></li>
</ul></li>
<li class="part"><span><b>VI The Modern Era</b></span></li>
<li class="chapter" data-level="23" data-path="modern-overview.html"><a href="modern-overview.html"><i class="fa fa-check"></i><b>23</b> Overview</a></li>
<li class="chapter" data-level="24" data-path="regularization.html"><a href="regularization.html"><i class="fa fa-check"></i><b>24</b> Regularization</a><ul>
<li class="chapter" data-level="24.1" data-path="regularization.html"><a href="regularization.html#ridge-regression"><i class="fa fa-check"></i><b>24.1</b> Ridge Regression</a></li>
<li class="chapter" data-level="24.2" data-path="regularization.html"><a href="regularization.html#lasso"><i class="fa fa-check"></i><b>24.2</b> Lasso</a></li>
<li class="chapter" data-level="24.3" data-path="regularization.html"><a href="regularization.html#broom"><i class="fa fa-check"></i><b>24.3</b> <code>broom</code></a></li>
<li class="chapter" data-level="24.4" data-path="regularization.html"><a href="regularization.html#simulation-study-p-n"><i class="fa fa-check"></i><b>24.4</b> Simulation Study, p &gt; n</a></li>
<li class="chapter" data-level="24.5" data-path="regularization.html"><a href="regularization.html#external-links-6"><i class="fa fa-check"></i><b>24.5</b> External Links</a></li>
<li class="chapter" data-level="24.6" data-path="regularization.html"><a href="regularization.html#rmarkdown-12"><i class="fa fa-check"></i><b>24.6</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="elastic-net.html"><a href="elastic-net.html"><i class="fa fa-check"></i><b>25</b> Elastic Net</a><ul>
<li class="chapter" data-level="25.1" data-path="elastic-net.html"><a href="elastic-net.html#hitters-data"><i class="fa fa-check"></i><b>25.1</b> Hitters Data</a></li>
<li class="chapter" data-level="25.2" data-path="elastic-net.html"><a href="elastic-net.html#elastic-net-for-regression"><i class="fa fa-check"></i><b>25.2</b> Elastic Net for Regression</a></li>
<li class="chapter" data-level="25.3" data-path="elastic-net.html"><a href="elastic-net.html#elastic-net-for-classification"><i class="fa fa-check"></i><b>25.3</b> Elastic Net for Classification</a></li>
<li class="chapter" data-level="25.4" data-path="elastic-net.html"><a href="elastic-net.html#external-links-7"><i class="fa fa-check"></i><b>25.4</b> External Links</a></li>
<li class="chapter" data-level="25.5" data-path="elastic-net.html"><a href="elastic-net.html#rmarkdown-13"><i class="fa fa-check"></i><b>25.5</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="trees.html"><a href="trees.html"><i class="fa fa-check"></i><b>26</b> Trees</a><ul>
<li class="chapter" data-level="26.1" data-path="trees.html"><a href="trees.html#classification-trees"><i class="fa fa-check"></i><b>26.1</b> Classification Trees</a></li>
<li class="chapter" data-level="26.2" data-path="trees.html"><a href="trees.html#regression-trees"><i class="fa fa-check"></i><b>26.2</b> Regression Trees</a></li>
<li class="chapter" data-level="26.3" data-path="trees.html"><a href="trees.html#rpart-package"><i class="fa fa-check"></i><b>26.3</b> <code>rpart</code> Package</a></li>
<li class="chapter" data-level="26.4" data-path="trees.html"><a href="trees.html#external-links-8"><i class="fa fa-check"></i><b>26.4</b> External Links</a></li>
<li class="chapter" data-level="26.5" data-path="trees.html"><a href="trees.html#rmarkdown-14"><i class="fa fa-check"></i><b>26.5</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="ensemble-methods.html"><a href="ensemble-methods.html"><i class="fa fa-check"></i><b>27</b> Ensemble Methods</a><ul>
<li class="chapter" data-level="27.1" data-path="ensemble-methods.html"><a href="ensemble-methods.html#regression"><i class="fa fa-check"></i><b>27.1</b> Regression</a><ul>
<li class="chapter" data-level="27.1.1" data-path="ensemble-methods.html"><a href="ensemble-methods.html#tree-model"><i class="fa fa-check"></i><b>27.1.1</b> Tree Model</a></li>
<li class="chapter" data-level="27.1.2" data-path="ensemble-methods.html"><a href="ensemble-methods.html#linear-model"><i class="fa fa-check"></i><b>27.1.2</b> Linear Model</a></li>
<li class="chapter" data-level="27.1.3" data-path="ensemble-methods.html"><a href="ensemble-methods.html#bagging"><i class="fa fa-check"></i><b>27.1.3</b> Bagging</a></li>
<li class="chapter" data-level="27.1.4" data-path="ensemble-methods.html"><a href="ensemble-methods.html#random-forest"><i class="fa fa-check"></i><b>27.1.4</b> Random Forest</a></li>
<li class="chapter" data-level="27.1.5" data-path="ensemble-methods.html"><a href="ensemble-methods.html#boosting"><i class="fa fa-check"></i><b>27.1.5</b> Boosting</a></li>
<li class="chapter" data-level="27.1.6" data-path="ensemble-methods.html"><a href="ensemble-methods.html#results"><i class="fa fa-check"></i><b>27.1.6</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="27.2" data-path="ensemble-methods.html"><a href="ensemble-methods.html#classification"><i class="fa fa-check"></i><b>27.2</b> Classification</a><ul>
<li class="chapter" data-level="27.2.1" data-path="ensemble-methods.html"><a href="ensemble-methods.html#tree-model-1"><i class="fa fa-check"></i><b>27.2.1</b> Tree Model</a></li>
<li class="chapter" data-level="27.2.2" data-path="ensemble-methods.html"><a href="ensemble-methods.html#logistic-regression-1"><i class="fa fa-check"></i><b>27.2.2</b> Logistic Regression</a></li>
<li class="chapter" data-level="27.2.3" data-path="ensemble-methods.html"><a href="ensemble-methods.html#bagging-1"><i class="fa fa-check"></i><b>27.2.3</b> Bagging</a></li>
<li class="chapter" data-level="27.2.4" data-path="ensemble-methods.html"><a href="ensemble-methods.html#random-forest-1"><i class="fa fa-check"></i><b>27.2.4</b> Random Forest</a></li>
<li class="chapter" data-level="27.2.5" data-path="ensemble-methods.html"><a href="ensemble-methods.html#boosting-1"><i class="fa fa-check"></i><b>27.2.5</b> Boosting</a></li>
<li class="chapter" data-level="27.2.6" data-path="ensemble-methods.html"><a href="ensemble-methods.html#results-1"><i class="fa fa-check"></i><b>27.2.6</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="27.3" data-path="ensemble-methods.html"><a href="ensemble-methods.html#tuning"><i class="fa fa-check"></i><b>27.3</b> Tuning</a><ul>
<li class="chapter" data-level="27.3.1" data-path="ensemble-methods.html"><a href="ensemble-methods.html#random-forest-and-bagging"><i class="fa fa-check"></i><b>27.3.1</b> Random Forest and Bagging</a></li>
<li class="chapter" data-level="27.3.2" data-path="ensemble-methods.html"><a href="ensemble-methods.html#boosting-2"><i class="fa fa-check"></i><b>27.3.2</b> Boosting</a></li>
</ul></li>
<li class="chapter" data-level="27.4" data-path="ensemble-methods.html"><a href="ensemble-methods.html#tree-versus-ensemble-boundaries"><i class="fa fa-check"></i><b>27.4</b> Tree versus Ensemble Boundaries</a></li>
<li class="chapter" data-level="27.5" data-path="ensemble-methods.html"><a href="ensemble-methods.html#external-links-9"><i class="fa fa-check"></i><b>27.5</b> External Links</a></li>
<li class="chapter" data-level="27.6" data-path="ensemble-methods.html"><a href="ensemble-methods.html#rmarkdown-15"><i class="fa fa-check"></i><b>27.6</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="artificial-neural-networks.html"><a href="artificial-neural-networks.html"><i class="fa fa-check"></i><b>28</b> Artificial Neural Networks</a></li>
<li class="part"><span><b>VII Appendix</b></span></li>
<li class="chapter" data-level="29" data-path="appendix-overview.html"><a href="appendix-overview.html"><i class="fa fa-check"></i><b>29</b> Overview</a></li>
<li class="chapter" data-level="30" data-path="non-linear-models.html"><a href="non-linear-models.html"><i class="fa fa-check"></i><b>30</b> Non-Linear Models</a></li>
<li class="chapter" data-level="31" data-path="regularized-discriminant-analysis.html"><a href="regularized-discriminant-analysis.html"><i class="fa fa-check"></i><b>31</b> Regularized Discriminant Analysis</a></li>
<li class="chapter" data-level="32" data-path="support-vector-machines.html"><a href="support-vector-machines.html"><i class="fa fa-check"></i><b>32</b> Support Vector Machines</a></li>
<li class="divider"></li>
<li><a href="https://github.com/daviddalpiaz/r4sl" target="blank">&copy; 2017 David Dalpiaz</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><code>R</code> for Statistical Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ensemble-methods" class="section level1">
<h1><span class="header-section-number">Chapter 27</span> Ensemble Methods</h1>
<p>We’ll now consider ensembles of trees.</p>
<div id="regression" class="section level2">
<h2><span class="header-section-number">27.1</span> Regression</h2>
<p>We first consider the regression case, using the <code>Boston</code> data from the <code>MASS</code> package. We will use RMSE as our metric, so we write a function which will help us along the way.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rmse =<span class="st"> </span>function(actual, predicted) {
  <span class="kw">sqrt</span>(<span class="kw">mean</span>((actual -<span class="st"> </span>predicted) ^<span class="st"> </span><span class="dv">2</span>))
}</code></pre></div>
<p>We also load all of the packages that we will need.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tree)
<span class="kw">library</span>(MASS)
<span class="kw">library</span>(ISLR)
<span class="kw">library</span>(randomForest)
<span class="kw">library</span>(gbm)
<span class="kw">library</span>(caret)</code></pre></div>
<p>We first test-train split the data and fit the same pruned tree as before. (Note: When pruning the tree, the best tree is actually the unpruned tree. View the results of <code>cv.tree</code> to see this. However, we select the tree of size 7 as the best of the pruned trees.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">18</span>)
boston_idx =<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span>:<span class="kw">nrow</span>(Boston), <span class="kw">nrow</span>(Boston) /<span class="st"> </span><span class="dv">2</span>)
boston_trn =<span class="st"> </span>Boston[boston_idx,]
boston_tst =<span class="st"> </span>Boston[-boston_idx,]</code></pre></div>
<div id="tree-model" class="section level3">
<h3><span class="header-section-number">27.1.1</span> Tree Model</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston_tree =<span class="st"> </span><span class="kw">tree</span>(medv ~<span class="st"> </span>., <span class="dt">data =</span> boston_trn)
<span class="kw">set.seed</span>(<span class="dv">18</span>)
boston_tree_cv =<span class="st"> </span><span class="kw">cv.tree</span>(boston_tree)
boston_tree_prune =<span class="st"> </span><span class="kw">prune.tree</span>(boston_tree, <span class="dt">best =</span> <span class="dv">7</span>)
boston_prune_tst_pred =<span class="st"> </span><span class="kw">predict</span>(boston_tree_prune, <span class="dt">newdata =</span> boston_tst)
<span class="kw">plot</span>(boston_prune_tst_pred, boston_tst$medv, 
     <span class="dt">xlab =</span> <span class="st">&quot;Predicted&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Actual&quot;</span>, 
     <span class="dt">main =</span> <span class="st">&quot;Predicted vs Actual: Tree, Test Data&quot;</span>)
<span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="27-ensemble_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">tree_tst_rmse =</span> <span class="kw">rmse</span>(boston_prune_tst_pred, boston_tst$medv))</code></pre></div>
<pre><code>## [1] 5.331457</code></pre>
</div>
<div id="linear-model" class="section level3">
<h3><span class="header-section-number">27.1.2</span> Linear Model</h3>
<p>Last time, we also fit an additive linear model, which we found to work better than the tree. The test RMSE is lower, and the predicted vs actual plot looks much better.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bostom_lm =<span class="st"> </span><span class="kw">lm</span>(medv ~<span class="st"> </span>., <span class="dt">data =</span> boston_trn)
boston_lm_tst_pred =<span class="st"> </span><span class="kw">predict</span>(bostom_lm, <span class="dt">newdata =</span> boston_tst)
<span class="kw">plot</span>(boston_lm_tst_pred, boston_tst$medv,
     <span class="dt">xlab =</span> <span class="st">&quot;Predicted&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Actual&quot;</span>,
     <span class="dt">main =</span> <span class="st">&quot;Predicted vs Actual: Linear Model, Test Data&quot;</span>
)
<span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="27-ensemble_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">lm_tst_rmse =</span> <span class="kw">rmse</span>(boston_lm_tst_pred, boston_tst$medv))</code></pre></div>
<pre><code>## [1] 5.125877</code></pre>
</div>
<div id="bagging" class="section level3">
<h3><span class="header-section-number">27.1.3</span> Bagging</h3>
<p>We now fit a bagged model, using the <code>randomForest</code> package. Bagging is actually a special case of a random forest where <code>mtry</code> is equal to <span class="math inline">\(p\)</span>, the number of predictors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston_bag =<span class="st"> </span><span class="kw">randomForest</span>(medv ~<span class="st"> </span>., <span class="dt">data =</span> boston_trn, <span class="dt">mtry =</span> <span class="dv">13</span>, 
                          <span class="dt">importance =</span> <span class="ot">TRUE</span>, <span class="dt">ntrees =</span> <span class="dv">500</span>)
boston_bag</code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = medv ~ ., data = boston_trn, mtry = 13,      importance = TRUE, ntrees = 500) 
##                Type of random forest: regression
##                      Number of trees: 500
## No. of variables tried at each split: 13
## 
##           Mean of squared residuals: 14.20299
##                     % Var explained: 80.92</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston_bag_tst_pred =<span class="st"> </span><span class="kw">predict</span>(boston_bag, <span class="dt">newdata =</span> boston_tst)
<span class="kw">plot</span>(boston_bag_tst_pred,boston_tst$medv,
     <span class="dt">xlab =</span> <span class="st">&quot;Predicted&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Actual&quot;</span>,
     <span class="dt">main =</span> <span class="st">&quot;Predicted vs Actual: Bagged Model, Test Data&quot;</span>
)
<span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="27-ensemble_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">bag_tst_rmse =</span> <span class="kw">rmse</span>(boston_bag_tst_pred, boston_tst$medv))</code></pre></div>
<pre><code>## [1] 3.814368</code></pre>
<p>Here we see two interesting results. First, the predicted versus actual plot no longer has a small number of predicted values. Second, our test error has dropped dramatically. Also note that the “Mean of squared residuals” which is output by <code>randomForest</code> is the <strong>Out of Bag</strong> estimate of the error.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(boston_bag)</code></pre></div>
<p><img src="27-ensemble_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="random-forest" class="section level3">
<h3><span class="header-section-number">27.1.4</span> Random Forest</h3>
<p>We now try a random forest. For regression, the suggestion is to use <code>mtry</code> equal to <span class="math inline">\(p/3\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston_forest =<span class="st"> </span><span class="kw">randomForest</span>(medv ~<span class="st"> </span>., <span class="dt">data =</span> boston_trn, <span class="dt">mtry =</span> <span class="dv">4</span>, 
                             <span class="dt">importance =</span> <span class="ot">TRUE</span>, <span class="dt">ntrees =</span> <span class="dv">500</span>)
boston_forest</code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = medv ~ ., data = boston_trn, mtry = 4,      importance = TRUE, ntrees = 500) 
##                Type of random forest: regression
##                      Number of trees: 500
## No. of variables tried at each split: 4
## 
##           Mean of squared residuals: 12.80737
##                     % Var explained: 82.79</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#importance(boston_forest)</span>
<span class="co">#varImpPlot(boston_forest)</span>
boston_forest_tst_pred =<span class="st"> </span><span class="kw">predict</span>(boston_forest, <span class="dt">newdata =</span> boston_tst)
<span class="kw">plot</span>(boston_forest_tst_pred, boston_tst$medv,
     <span class="dt">xlab =</span> <span class="st">&quot;Predicted&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Actual&quot;</span>,
     <span class="dt">main =</span> <span class="st">&quot;Predicted vs Actual: Random Forest, Test Data&quot;</span>
)
<span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="27-ensemble_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">forest_tst_rmse =</span> <span class="kw">rmse</span>(boston_forest_tst_pred, boston_tst$medv))</code></pre></div>
<pre><code>## [1] 3.73447</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston_forest_trn_pred =<span class="st"> </span><span class="kw">predict</span>(boston_forest, <span class="dt">newdata =</span> boston_trn)
forest_trn_rmse =<span class="st"> </span><span class="kw">rmse</span>(boston_forest_trn_pred, boston_trn$medv)
forest_oob_rmse =<span class="st"> </span><span class="kw">rmse</span>(boston_forest$predicted, boston_trn$medv)</code></pre></div>
<p>Here we note three RMSEs. The training RMSE (which is optimistic), the OOB RMSE (which is a good estimate of the test error) and the test RMSE. Also note that variables importance was calculated, however, the results are not shown here. (The code to view the results is commented out.)</p>
<pre><code>##       Data    Error
## 1 Training 1.563253
## 2      OOB 3.578738
## 3     Test 3.734470</code></pre>
</div>
<div id="boosting" class="section level3">
<h3><span class="header-section-number">27.1.5</span> Boosting</h3>
<p>Lastly, we try a boosted model, which by default will produce a nice <strong>variable importance</strong> plot as well as plots of the marginal effects of the predictors. We use the <code>gbm</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">booston_boost =<span class="st"> </span><span class="kw">gbm</span>(medv ~<span class="st"> </span>., <span class="dt">data =</span> boston_trn, <span class="dt">distribution =</span> <span class="st">&quot;gaussian&quot;</span>, 
                    <span class="dt">n.trees =</span> <span class="dv">5000</span>, <span class="dt">interaction.depth =</span> <span class="dv">4</span>, <span class="dt">shrinkage =</span> <span class="fl">0.01</span>)
booston_boost</code></pre></div>
<pre><code>## gbm(formula = medv ~ ., distribution = &quot;gaussian&quot;, data = boston_trn, 
##     n.trees = 5000, interaction.depth = 4, shrinkage = 0.01)
## A gradient boosted model with gaussian loss function.
## 5000 iterations were performed.
## There were 13 predictors of which 13 had non-zero influence.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(booston_boost)</code></pre></div>
<p><img src="27-ensemble_files/figure-html/unnamed-chunk-10-1.png" width="768" /></p>
<pre><code>##             var    rel.inf
## rm           rm 33.1305117
## lstat     lstat 32.0413077
## dis         dis 10.1450348
## crim       crim  6.4535978
## black     black  4.7076459
## nox         nox  4.1647148
## age         age  3.4933055
## ptratio ptratio  2.1056374
## tax         tax  1.3320146
## indus     indus  0.9248479
## rad         rad  0.7800278
## chas       chas  0.5731764
## zn           zn  0.1481777</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(booston_boost, <span class="dt">i =</span> <span class="st">&quot;rm&quot;</span>)
<span class="kw">plot</span>(booston_boost, <span class="dt">i =</span> <span class="st">&quot;lstat&quot;</span>)</code></pre></div>
<p><img src="27-ensemble_files/figure-html/unnamed-chunk-10-2.png" width="768" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston_boost_tst_pred =<span class="st"> </span><span class="kw">predict</span>(booston_boost, <span class="dt">newdata =</span> boston_tst, <span class="dt">n.trees =</span> <span class="dv">5000</span>)
(<span class="dt">boost_tst_rmse =</span> <span class="kw">rmse</span>(boston_boost_tst_pred, boston_tst$medv))</code></pre></div>
<pre><code>## [1] 3.437024</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(boston_boost_tst_pred, boston_tst$medv,
     <span class="dt">xlab =</span> <span class="st">&quot;Predicted&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Actual&quot;</span>, 
     <span class="dt">main =</span> <span class="st">&quot;Predicted vs Actual: Boosted Model, Test Data&quot;</span>
)
<span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="27-ensemble_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="results" class="section level3">
<h3><span class="header-section-number">27.1.6</span> Results</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">boston_rmse =</span> <span class="kw">data.frame</span>(
  <span class="dt">Model =</span> <span class="kw">c</span>(<span class="st">&quot;Single Tree&quot;</span>, <span class="st">&quot;Linear Model&quot;</span>, <span class="st">&quot;Bagging&quot;</span>,  <span class="st">&quot;Random Forest&quot;</span>,  <span class="st">&quot;Boosting&quot;</span>),
  <span class="dt">TestError =</span> <span class="kw">c</span>(tree_tst_rmse, lm_tst_rmse, bag_tst_rmse, forest_tst_rmse, boost_tst_rmse)
  )
)</code></pre></div>
<pre><code>##           Model TestError
## 1   Single Tree  5.331457
## 2  Linear Model  5.125877
## 3       Bagging  3.814368
## 4 Random Forest  3.734470
## 5      Boosting  3.437024</code></pre>
<p>While a single tree does not beat linear regression, each of the ensemble methods perform much better!</p>
</div>
</div>
<div id="classification" class="section level2">
<h2><span class="header-section-number">27.2</span> Classification</h2>
<p>We now return to the <code>Carseats</code> dataset and the classification setting. We see that an additive logistic regression performs much better than a single tree, but we expect ensemble methods to bring trees closer to the logistic regression. Can they do better?</p>
<p>We now use prediction accuracy as our metric:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">accuracy =<span class="st"> </span>function(actual, predicted) {
  <span class="kw">mean</span>(actual ==<span class="st"> </span>predicted)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(Carseats)
Carseats$Sales =<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">ifelse</span>(Carseats$Sales &lt;=<span class="st"> </span><span class="dv">8</span>, <span class="st">&quot;Low&quot;</span>, <span class="st">&quot;High&quot;</span>))
<span class="kw">set.seed</span>(<span class="dv">2</span>)
seat_idx =<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span>:<span class="kw">nrow</span>(Carseats), <span class="dv">200</span>)
seat_trn =<span class="st"> </span>Carseats[seat_idx,]
seat_tst =<span class="st"> </span>Carseats[-seat_idx,]</code></pre></div>
<div id="tree-model-1" class="section level3">
<h3><span class="header-section-number">27.2.1</span> Tree Model</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seat_tree =<span class="st"> </span><span class="kw">tree</span>(Sales ~<span class="st"> </span>., <span class="dt">data =</span> seat_trn)
<span class="kw">set.seed</span>(<span class="dv">3</span>)
seat_tree_cv =<span class="st"> </span><span class="kw">cv.tree</span>(seat_tree, <span class="dt">FUN =</span> prune.misclass)

seat_tree_prune =<span class="st"> </span><span class="kw">prune.misclass</span>(seat_tree, <span class="dt">best =</span> <span class="dv">9</span>)
seat_prune_tst_pred =<span class="st"> </span><span class="kw">predict</span>(seat_tree_prune, seat_tst, <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>)

<span class="kw">table</span>(<span class="dt">predicted =</span> seat_prune_tst_pred, <span class="dt">actual =</span> seat_tst$Sales)</code></pre></div>
<pre><code>##          actual
## predicted High Low
##      High   60  22
##      Low    24  94</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">tree_tst_acc =</span> <span class="kw">accuracy</span>(<span class="dt">predicted =</span> seat_prune_tst_pred, <span class="dt">actual =</span> seat_tst$Sales))</code></pre></div>
<pre><code>## [1] 0.77</code></pre>
</div>
<div id="logistic-regression-1" class="section level3">
<h3><span class="header-section-number">27.2.2</span> Logistic Regression</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seat_glm =<span class="st"> </span><span class="kw">glm</span>(Sales ~<span class="st"> </span>., <span class="dt">data =</span> seat_trn, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)
seat_glm_tst_pred =<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">predict</span>(seat_glm, seat_tst, <span class="st">&quot;response&quot;</span>) &gt;<span class="st"> </span><span class="fl">0.5</span>, 
                           <span class="st">&quot;Low&quot;</span>, <span class="st">&quot;High&quot;</span>)
<span class="kw">table</span>(<span class="dt">predicted =</span> seat_glm_tst_pred, <span class="dt">actual =</span> seat_tst$Sales)</code></pre></div>
<pre><code>##          actual
## predicted High Low
##      High   75   9
##      Low     9 107</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">glm_tst_acc =</span> <span class="kw">accuracy</span>(<span class="dt">predicted =</span> seat_glm_tst_pred, <span class="dt">actual =</span> seat_tst$Sales))</code></pre></div>
<pre><code>## [1] 0.91</code></pre>
</div>
<div id="bagging-1" class="section level3">
<h3><span class="header-section-number">27.2.3</span> Bagging</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seat_bag =<span class="st"> </span><span class="kw">randomForest</span>(Sales ~<span class="st"> </span>., <span class="dt">data =</span> seat_trn, <span class="dt">mtry =</span> <span class="dv">10</span>, 
                        <span class="dt">importance =</span> <span class="ot">TRUE</span>, <span class="dt">ntrees =</span> <span class="dv">500</span>)
seat_bag</code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = Sales ~ ., data = seat_trn, mtry = 10,      importance = TRUE, ntrees = 500) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 10
## 
##         OOB estimate of  error rate: 21.5%
## Confusion matrix:
##      High Low class.error
## High   51  29   0.3625000
## Low    14 106   0.1166667</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seat_bag_tst_pred =<span class="st"> </span><span class="kw">predict</span>(seat_bag, <span class="dt">newdata =</span> seat_tst)
<span class="kw">table</span>(<span class="dt">predicted =</span> seat_bag_tst_pred, <span class="dt">actual =</span> seat_tst$Sales)</code></pre></div>
<pre><code>##          actual
## predicted High Low
##      High   68  21
##      Low    16  95</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">bag_tst_acc =</span> <span class="kw">accuracy</span>(<span class="dt">predicted =</span> seat_bag_tst_pred, <span class="dt">actual =</span> seat_tst$Sales))</code></pre></div>
<pre><code>## [1] 0.815</code></pre>
</div>
<div id="random-forest-1" class="section level3">
<h3><span class="header-section-number">27.2.4</span> Random Forest</h3>
<p>For classification, the suggested <code>mtry</code> for a random forest is <span class="math inline">\(\sqrt{p}.\)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seat_forest =<span class="st"> </span><span class="kw">randomForest</span>(Sales ~<span class="st"> </span>., <span class="dt">data =</span> seat_trn, <span class="dt">mtry =</span> <span class="dv">3</span>, <span class="dt">importance =</span> <span class="ot">TRUE</span>, <span class="dt">ntrees =</span> <span class="dv">500</span>)
seat_forest</code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = Sales ~ ., data = seat_trn, mtry = 3,      importance = TRUE, ntrees = 500) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 3
## 
##         OOB estimate of  error rate: 22%
## Confusion matrix:
##      High Low class.error
## High   49  31   0.3875000
## Low    13 107   0.1083333</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seat_forest_tst_perd =<span class="st"> </span><span class="kw">predict</span>(seat_forest, <span class="dt">newdata =</span> seat_tst)
<span class="kw">table</span>(<span class="dt">predicted =</span> seat_forest_tst_perd, <span class="dt">actual =</span> seat_tst$Sales)</code></pre></div>
<pre><code>##          actual
## predicted High Low
##      High   63  16
##      Low    21 100</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">forest_tst_acc =</span> <span class="kw">accuracy</span>(<span class="dt">predicted =</span> seat_forest_tst_perd, <span class="dt">actual =</span> seat_tst$Sales))</code></pre></div>
<pre><code>## [1] 0.815</code></pre>
</div>
<div id="boosting-1" class="section level3">
<h3><span class="header-section-number">27.2.5</span> Boosting</h3>
<p>To perform boosting, we modify the response to be <code>0</code> and <code>1</code> to work with <code>gbm</code>. Later we will use <code>caret</code> to fit <code>gbm</code> models, which will avoid this annoyance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seat_trn_mod =<span class="st"> </span>seat_trn
seat_trn_mod$Sales =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">ifelse</span>(seat_trn_mod$Sales ==<span class="st"> &quot;Low&quot;</span>, <span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>))

seat_boost =<span class="st"> </span><span class="kw">gbm</span>(Sales ~<span class="st"> </span>., <span class="dt">data =</span> seat_trn_mod, <span class="dt">distribution =</span> <span class="st">&quot;bernoulli&quot;</span>, 
                 <span class="dt">n.trees =</span> <span class="dv">5000</span>, <span class="dt">interaction.depth =</span> <span class="dv">4</span>, <span class="dt">shrinkage =</span> <span class="fl">0.01</span>)
seat_boost</code></pre></div>
<pre><code>## gbm(formula = Sales ~ ., distribution = &quot;bernoulli&quot;, data = seat_trn_mod, 
##     n.trees = 5000, interaction.depth = 4, shrinkage = 0.01)
## A gradient boosted model with bernoulli loss function.
## 5000 iterations were performed.
## There were 10 predictors of which 10 had non-zero influence.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seat_boost_tst_pred =<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">predict</span>(seat_boost, seat_tst, <span class="dt">n.trees =</span> <span class="dv">5000</span>, <span class="st">&quot;response&quot;</span>) &gt;<span class="st"> </span><span class="fl">0.5</span>, 
                             <span class="st">&quot;High&quot;</span>, <span class="st">&quot;Low&quot;</span>)
<span class="kw">table</span>(<span class="dt">predicted =</span> seat_boost_tst_pred, <span class="dt">actual =</span> seat_tst$Sales)</code></pre></div>
<pre><code>##          actual
## predicted High Low
##      High   70  17
##      Low    14  99</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">boost_tst_acc =</span> <span class="kw">accuracy</span>(<span class="dt">predicted =</span> seat_boost_tst_pred, <span class="dt">actual =</span> seat_tst$Sales))</code></pre></div>
<pre><code>## [1] 0.845</code></pre>
</div>
<div id="results-1" class="section level3">
<h3><span class="header-section-number">27.2.6</span> Results</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">seat_acc =</span> <span class="kw">data.frame</span>(
  <span class="dt">Model =</span> <span class="kw">c</span>(<span class="st">&quot;Single Tree&quot;</span>, <span class="st">&quot;Logistic Regression&quot;</span>, <span class="st">&quot;Bagging&quot;</span>,  <span class="st">&quot;Random Forest&quot;</span>,  <span class="st">&quot;Boosting&quot;</span>),
  <span class="dt">TestAccuracy =</span> <span class="kw">c</span>(tree_tst_acc, glm_tst_acc, bag_tst_acc, forest_tst_acc, boost_tst_acc)
  )
)</code></pre></div>
<pre><code>##                 Model TestAccuracy
## 1         Single Tree        0.770
## 2 Logistic Regression        0.910
## 3             Bagging        0.815
## 4       Random Forest        0.815
## 5            Boosting        0.845</code></pre>
<p>Here we see each of the ensemble methods performing better than a single tree, however, they still fall behind logistic regression. Sometimes a simple linear model will beat more complicated models! This is why you should always try a logistic regression for classification.</p>
</div>
</div>
<div id="tuning" class="section level2">
<h2><span class="header-section-number">27.3</span> Tuning</h2>
<p>So far we fit bagging, boosting and random forest models, but did not tune any of them, we simply used certain, somewhat arbitrary, parameters. Now we will see how to modify the tuning parameters to make these models better.</p>
<ul>
<li>Bagging: Actually just a subset of Random Forest with <code>mtry</code> = <span class="math inline">\(p\)</span>.</li>
<li>Random Forest: <code>mtry</code></li>
<li>Boosting: <code>n.trees</code>, <code>interaction.depth</code>, <code>shrinkage</code>, <code>n.minobsinnode</code></li>
</ul>
<p>We will use the <code>caret</code> package to accomplish this. Technically <code>ntrees</code> is a tuning parameter for both bagging and random forest, but <code>caret</code> will use 500 by default and there is no easy way to tune it. This will not make a big difference since for both we simply need “enough” and 500 seems to do the trick.</p>
<p>While <code>mtry</code> is a tuning parameter, there are suggested values for classification and regression:</p>
<ul>
<li>Regression: <code>mtry</code> = <span class="math inline">\(p/3.\)</span></li>
<li>Classification: <code>mtry</code> = <span class="math inline">\(\sqrt{p}.\)</span></li>
</ul>
<p>Also note that with these tree-based ensemble methods there are two resampling solutions for tuning the model:</p>
<ul>
<li>Out of Bag</li>
<li>Cross-Validation</li>
</ul>
<p>Using Out of Bag samples is advantageous with these methods as compared to Cross-Validation since it removes the need to refit the model and is thus much more computationally efficient. Unfortunately OOB methods cannot be used with <code>gbm</code> models. See the <a href="http://topepo.github.io/caret/training.html"><code>caret</code> documentation</a> for details.</p>
<div id="random-forest-and-bagging" class="section level3">
<h3><span class="header-section-number">27.3.1</span> Random Forest and Bagging</h3>
<p>Here we setup training control for both OOB and cross-validation methods. Note we specify <code>verbose = FALSE</code> which suppresses output related to progress. You may wish to set this to <code>TRUE</code> when first tuning a model since it will give you an idea of how long the tuning process will take. (Which can sometimes be a long time.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">oob =<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;oob&quot;</span>)
cv_5 =<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>)</code></pre></div>
<p>To tune a Random Forest in <code>caret</code> we will use <code>method = &quot;rf&quot;</code> which uses the <code>randomForest</code> function in the background. Here we elect to use the OOB training control that we created. We could also use Cross-Validation, however it will likely select a similar model, but requiring more time.</p>
<p>We setup a grid of <code>mtry</code> values which include all possible values since there are <span class="math inline">\(10\)</span> predictors in the dataset. An <code>mtry</code> of <span class="math inline">\(10\)</span> is actually bagging.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(seat_trn)</code></pre></div>
<pre><code>## [1] 200  11</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf_grid =<span class="st">  </span><span class="kw">expand.grid</span>(<span class="dt">mtry =</span> <span class="dv">1</span>:<span class="dv">10</span>)
<span class="kw">set.seed</span>(<span class="dv">825</span>)
seat_rf_tune =<span class="st"> </span><span class="kw">train</span>(Sales ~<span class="st"> </span>., <span class="dt">data =</span> seat_trn,
                     <span class="dt">method =</span> <span class="st">&quot;rf&quot;</span>,
                     <span class="dt">trControl =</span> oob,
                     <span class="dt">verbose =</span> <span class="ot">FALSE</span>,
                     <span class="dt">tuneGrid =</span> rf_grid)
seat_rf_tune</code></pre></div>
<pre><code>## Random Forest 
## 
## 200 samples
##  10 predictor
##   2 classes: &#39;High&#39;, &#39;Low&#39; 
## 
## No pre-processing
## Resampling results across tuning parameters:
## 
##   mtry  Accuracy  Kappa    
##    1    0.730     0.3807339
##    2    0.775     0.5033113
##    3    0.795     0.5591398
##    4    0.790     0.5474138
##    5    0.795     0.5610278
##    6    0.790     0.5512821
##    7    0.805     0.5806452
##    8    0.795     0.5628998
##    9    0.785     0.5376344
##   10    0.775     0.5202559
## 
## Accuracy was used to select the optimal model using  the largest value.
## The final value used for the model was mtry = 7.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">accuracy</span>(<span class="kw">predict</span>(seat_rf_tune, seat_tst), seat_tst$Sales)</code></pre></div>
<pre><code>## [1] 0.795</code></pre>
<p>The results returned are based on the OOB samples. (Coincidentally, the test accuracy is the same as the best accuracy found using OOB samples.) Note that when using OOB, for some reason the default plot is not what you would expect and is not at all useful. (Which is why it is omitted here.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seat_rf_tune$bestTune</code></pre></div>
<pre><code>##   mtry
## 7    7</code></pre>
<p>Based on these results, we would select the random forest model with an <code>mtry</code> of 7. Note that based on the OOB estimates, the bagging model is expected to perform worse than this select model, however, based on our results above, that is not what we find to be true in our test set.</p>
<p>Also note that <code>method = &quot;ranger&quot;</code> would also fit a random forest model. <a href="http://arxiv.org/pdf/1508.04409.pdf">Ranger</a> is a newer <code>R</code> package for random forests that has been shown to be much faster, especially when there are a larger number of predictors.</p>
</div>
<div id="boosting-2" class="section level3">
<h3><span class="header-section-number">27.3.2</span> Boosting</h3>
<p>We now tune a boosted tree model. We will use the cross-validation tune control setup above. We will fit the model using <code>gbm</code> with <code>caret</code>.</p>
<p>To setup the tuning grid, we must specify four parameters to tune:</p>
<ul>
<li><code>interaction.depth</code>: How many splits to use with each tree.</li>
<li><code>n.trees</code>: The number of trees to use.</li>
<li><code>shrinkage</code>: The shrinkage parameters, which controls how fast the method learns.</li>
<li><code>n.minobsinnode</code>: The minimum number of observations in a node of the tree. (<code>caret</code> requires us to specify this. This is actually a tuning parameter of the trees, not boosting, and we would normally just accept the default.)</li>
</ul>
<p>Finally, <code>expand.grid</code> comes in handy, as we can specify a vector of values for each parameter, then we get back a matrix of all possible combinations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gbm_grid =<span class="st">  </span><span class="kw">expand.grid</span>(<span class="dt">interaction.depth =</span> <span class="dv">1</span>:<span class="dv">5</span>,
                        <span class="dt">n.trees =</span> (<span class="dv">1</span>:<span class="dv">6</span>) *<span class="st"> </span><span class="dv">500</span>,
                        <span class="dt">shrinkage =</span> <span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>),
                        <span class="dt">n.minobsinnode =</span> <span class="dv">10</span>)</code></pre></div>
<p>We now train the model using all possible combinations of the tuning parameters we just specified.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seat_gbm_tune =<span class="st"> </span><span class="kw">train</span>(Sales ~<span class="st"> </span>., <span class="dt">data =</span> seat_trn,
                      <span class="dt">method =</span> <span class="st">&quot;gbm&quot;</span>,
                      <span class="dt">trControl =</span> cv_5,
                      <span class="dt">verbose =</span> <span class="ot">FALSE</span>,
                      <span class="dt">tuneGrid =</span> gbm_grid)</code></pre></div>
<p>The additional <code>verbose = FALSE</code> in the <code>train</code> call suppresses additional output from each <code>gbm</code> call.</p>
<p>By default, calling <code>plot</code> here will produce a nice graphic of the results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#seat_gbm_tune</span>
<span class="kw">plot</span>(seat_gbm_tune)</code></pre></div>
<p><img src="27-ensemble_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">accuracy</span>(<span class="kw">predict</span>(seat_gbm_tune, seat_tst), seat_tst$Sales)</code></pre></div>
<pre><code>## [1] 0.845</code></pre>
<p>We see our tuned model does no better on the test set than the arbitrary boosted model we had fit above, with the slightly different parameters seen below. We could perhaps try a larger tuning grid, but at this point it seems unlikely that we could find a much better model. There seems to be no way to get a tree method to out-perform logistic regression in this dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seat_gbm_tune$bestTune</code></pre></div>
<pre><code>##    n.trees interaction.depth shrinkage n.minobsinnode
## 61     500                 1       0.1             10</code></pre>
</div>
</div>
<div id="tree-versus-ensemble-boundaries" class="section level2">
<h2><span class="header-section-number">27.4</span> Tree versus Ensemble Boundaries</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mlbench)
<span class="kw">set.seed</span>(<span class="dv">42</span>)
sim_trn =<span class="st"> </span><span class="kw">mlbench.circle</span>(<span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">d =</span> <span class="dv">2</span>)
sim_trn =<span class="st"> </span><span class="kw">data.frame</span>(sim_trn$x, <span class="dt">class =</span> <span class="kw">as.factor</span>(sim_trn$classes))
sim_tst =<span class="st"> </span><span class="kw">mlbench.circle</span>(<span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">d =</span> <span class="dv">2</span>)
sim_tst =<span class="st"> </span><span class="kw">data.frame</span>(sim_tst$x, <span class="dt">class =</span> <span class="kw">as.factor</span>(sim_tst$classes))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(sim_trn$X1, sim_trn$X2, <span class="dt">col =</span> sim_trn$class,
     <span class="dt">xlab =</span> <span class="st">&quot;X1&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;X2&quot;</span>)</code></pre></div>
<p><img src="27-ensemble_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cv_5 =<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>)
oob  =<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;oob&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_tree_cv =<span class="st"> </span><span class="kw">train</span>(class ~<span class="st"> </span>.,
                    <span class="dt">data =</span> sim_trn,
                    <span class="dt">trControl =</span> cv_5,
                    <span class="dt">method =</span> <span class="st">&quot;rpart&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rpart.plot)
<span class="kw">prp</span>(sim_tree_cv$finalModel)</code></pre></div>
<p><img src="27-ensemble_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf_grid =<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">mtry =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
sim_rf_oob =<span class="st"> </span><span class="kw">train</span>(class ~<span class="st"> </span>.,
                   <span class="dt">data =</span> sim_trn,
                   <span class="dt">trControl =</span> oob,
                   <span class="dt">tuneGrid =</span> rf_grid)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gbm_grid =<span class="st">  </span><span class="kw">expand.grid</span>(<span class="dt">interaction.depth =</span> <span class="dv">1</span>:<span class="dv">5</span>,
                        <span class="dt">n.trees =</span> (<span class="dv">1</span>:<span class="dv">6</span>) *<span class="st"> </span><span class="dv">500</span>,
                        <span class="dt">shrinkage =</span> <span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>),
                        <span class="dt">n.minobsinnode =</span> <span class="dv">10</span>)

sim_gbm_cv =<span class="st"> </span><span class="kw">train</span>(class ~<span class="st"> </span>., 
                   <span class="dt">data =</span> sim_trn,
                   <span class="dt">method =</span> <span class="st">&quot;gbm&quot;</span>,
                   <span class="dt">trControl =</span> cv_5,
                   <span class="dt">verbose =</span> <span class="ot">FALSE</span>,
                   <span class="dt">tuneGrid =</span> gbm_grid)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_grid =<span class="st"> </span><span class="kw">expand.grid</span>(
  <span class="dt">X1 =</span> <span class="kw">seq</span>(<span class="kw">min</span>(sim_tst$X1), <span class="kw">max</span>(sim_tst$X1), <span class="dt">by =</span> <span class="fl">0.01</span>),
  <span class="dt">X2 =</span> <span class="kw">seq</span>(<span class="kw">min</span>(sim_tst$X2), <span class="kw">max</span>(sim_tst$X2), <span class="dt">by =</span> <span class="fl">0.01</span>)
)

tree_pred =<span class="st"> </span><span class="kw">predict</span>(sim_tree_cv, plot_grid)
rf_pred   =<span class="st"> </span><span class="kw">predict</span>(sim_rf_oob, plot_grid)
gbm_pred  =<span class="st"> </span><span class="kw">predict</span>(sim_gbm_cv, plot_grid)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))
<span class="kw">plot</span>(plot_grid$X1, plot_grid$X2, <span class="dt">col =</span> tree_pred,
     <span class="dt">xlab =</span> <span class="st">&quot;X1&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;X2&quot;</span>, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">main =</span> <span class="st">&quot;Single Tree&quot;</span>)
<span class="kw">plot</span>(plot_grid$X1, plot_grid$X2, <span class="dt">col =</span> rf_pred,
     <span class="dt">xlab =</span> <span class="st">&quot;X1&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;X2&quot;</span>, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">main =</span> <span class="st">&quot;Random Forest&quot;</span>)
<span class="kw">plot</span>(plot_grid$X1, plot_grid$X2, <span class="dt">col =</span> gbm_pred,
     <span class="dt">xlab =</span> <span class="st">&quot;X1&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;X2&quot;</span>, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">main =</span> <span class="st">&quot;Boosted Trees&quot;</span>)</code></pre></div>
<p><img src="27-ensemble_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
</div>
<div id="external-links-9" class="section level2">
<h2><span class="header-section-number">27.5</span> External Links</h2>
<ul>
<li><a href="http://www.bios.unc.edu/~dzeng/BIOS740/randomforest.pdf">Classification and Regression by <code>randomForest</code></a> - Introduction to the <code>randomForest</code> package in <code>R</code> news.</li>
<li><a href="https://github.com/imbs-hl/ranger"><code>ranger</code>: A Fast Implementation of Random Forests</a> - Alternative package for fitting random forests with potentially better speed.</li>
<li><a href="http://www.win-vector.com/blog/2016/05/on-ranger-respect-unordered-factors/">On <code>ranger</code>’s respect.unordered.factors Argument</a> - A note on handling of categorical variables with random forests.</li>
<li><a href="https://pdfs.semanticscholar.org/336a/165c17c9c56160d332b9f4a2b403fccbdbfb.pdf">Extremely Randomized Trees</a></li>
<li><a href="https://cran.r-project.org/web/packages/extraTrees/vignettes/extraTrees.pdf"><code>extraTrees</code> Method for Classificationand Regression</a></li>
<li><a href="http://xgboost.readthedocs.io/en/latest/">XGBoost</a> - Scalable and Flexible Gradient Boosting</li>
<li><a href="http://xgboost.readthedocs.io/en/latest/R-package/xgboostPresentation.html">XGBoost <code>R</code> Tutorial</a></li>
</ul>
</div>
<div id="rmarkdown-15" class="section level2">
<h2><span class="header-section-number">27.6</span> RMarkdown</h2>
<p>The RMarkdown file for this chapter can be found <a href="20-ensemble.Rmd"><strong>here</strong></a>. The file was created using <code>R</code> version 3.4.1 and the following packages:</p>
<ul>
<li>Base Packages, Attached</li>
</ul>
<pre><code>## [1] &quot;methods&quot;   &quot;parallel&quot;  &quot;splines&quot;   &quot;stats&quot;     &quot;graphics&quot;  &quot;grDevices&quot;
## [7] &quot;utils&quot;     &quot;datasets&quot;  &quot;base&quot;</code></pre>
<ul>
<li>Additional Packages, Attached</li>
</ul>
<pre><code>##  [1] &quot;rpart.plot&quot;   &quot;rpart&quot;        &quot;mlbench&quot;      &quot;plyr&quot;        
##  [5] &quot;caret&quot;        &quot;ggplot2&quot;      &quot;gbm&quot;          &quot;lattice&quot;     
##  [9] &quot;survival&quot;     &quot;randomForest&quot; &quot;ISLR&quot;         &quot;MASS&quot;        
## [13] &quot;tree&quot;</code></pre>
<ul>
<li>Additional Packages, Not Attached</li>
</ul>
<pre><code>##  [1] &quot;Rcpp&quot;         &quot;lubridate&quot;    &quot;class&quot;        &quot;assertthat&quot;  
##  [5] &quot;rprojroot&quot;    &quot;digest&quot;       &quot;ipred&quot;        &quot;foreach&quot;     
##  [9] &quot;R6&quot;           &quot;backports&quot;    &quot;stats4&quot;       &quot;evaluate&quot;    
## [13] &quot;e1071&quot;        &quot;rlang&quot;        &quot;lazyeval&quot;     &quot;kernlab&quot;     
## [17] &quot;Matrix&quot;       &quot;rmarkdown&quot;    &quot;CVST&quot;         &quot;ddalpha&quot;     
## [21] &quot;gower&quot;        &quot;stringr&quot;      &quot;munsell&quot;      &quot;compiler&quot;    
## [25] &quot;pkgconfig&quot;    &quot;dimRed&quot;       &quot;htmltools&quot;    &quot;nnet&quot;        
## [29] &quot;tibble&quot;       &quot;prodlim&quot;      &quot;DRR&quot;          &quot;bookdown&quot;    
## [33] &quot;codetools&quot;    &quot;RcppRoll&quot;     &quot;dplyr&quot;        &quot;withr&quot;       
## [37] &quot;recipes&quot;      &quot;ModelMetrics&quot; &quot;grid&quot;         &quot;nlme&quot;        
## [41] &quot;gtable&quot;       &quot;magrittr&quot;     &quot;scales&quot;       &quot;stringi&quot;     
## [45] &quot;reshape2&quot;     &quot;bindrcpp&quot;     &quot;timeDate&quot;     &quot;robustbase&quot;  
## [49] &quot;lava&quot;         &quot;iterators&quot;    &quot;tools&quot;        &quot;glue&quot;        
## [53] &quot;DEoptimR&quot;     &quot;purrr&quot;        &quot;yaml&quot;         &quot;colorspace&quot;  
## [57] &quot;knitr&quot;        &quot;bindr&quot;</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="trees.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="artificial-neural-networks.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/daviddalpiaz/r4sl/edit/master/27-ensemble.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
