<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R for Statistical Learning</title>
  <meta name="description" content="<code>R</code> for Statistical Learning">
  <meta name="generator" content="bookdown 0.5.4 and GitBook 2.6.7">

  <meta property="og:title" content="R for Statistical Learning" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://daviddalpiaz.github.io/r4sl/" />
  
  
  <meta name="github-repo" content="daviddalpiaz/r4sl" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R for Statistical Learning" />
  
  
  

<meta name="author" content="David Dalpiaz">


<meta name="date" content="2017-11-01">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="prev" href="resampling.html">
<link rel="next" href="subset-selection.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Statistical Learning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i>About This Book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#organization"><i class="fa fa-check"></i>Organization</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who"><i class="fa fa-check"></i>Who?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caveat-emptor"><i class="fa fa-check"></i>Caveat Emptor</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="part"><span><b>I Prerequisites</b></span></li>
<li class="chapter" data-level="1" data-path="prerequisites-overview.html"><a href="prerequisites-overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="probability-review.html"><a href="probability-review.html"><i class="fa fa-check"></i><b>2</b> Probability Review</a><ul>
<li class="chapter" data-level="2.1" data-path="probability-review.html"><a href="probability-review.html#probability-models"><i class="fa fa-check"></i><b>2.1</b> Probability Models</a></li>
<li class="chapter" data-level="2.2" data-path="probability-review.html"><a href="probability-review.html#probability-axioms"><i class="fa fa-check"></i><b>2.2</b> Probability Axioms</a></li>
<li class="chapter" data-level="2.3" data-path="probability-review.html"><a href="probability-review.html#probability-rules"><i class="fa fa-check"></i><b>2.3</b> Probability Rules</a></li>
<li class="chapter" data-level="2.4" data-path="probability-review.html"><a href="probability-review.html#random-variables"><i class="fa fa-check"></i><b>2.4</b> Random Variables</a><ul>
<li class="chapter" data-level="2.4.1" data-path="probability-review.html"><a href="probability-review.html#distributions"><i class="fa fa-check"></i><b>2.4.1</b> Distributions</a></li>
<li class="chapter" data-level="2.4.2" data-path="probability-review.html"><a href="probability-review.html#discrete-random-variables"><i class="fa fa-check"></i><b>2.4.2</b> Discrete Random Variables</a></li>
<li class="chapter" data-level="2.4.3" data-path="probability-review.html"><a href="probability-review.html#continuous-random-variables"><i class="fa fa-check"></i><b>2.4.3</b> Continuous Random Variables</a></li>
<li class="chapter" data-level="2.4.4" data-path="probability-review.html"><a href="probability-review.html#several-random-variables"><i class="fa fa-check"></i><b>2.4.4</b> Several Random Variables</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="probability-review.html"><a href="probability-review.html#expectations"><i class="fa fa-check"></i><b>2.5</b> Expectations</a></li>
<li class="chapter" data-level="2.6" data-path="probability-review.html"><a href="probability-review.html#likelihood"><i class="fa fa-check"></i><b>2.6</b> Likelihood</a></li>
<li class="chapter" data-level="2.7" data-path="probability-review.html"><a href="probability-review.html#videos"><i class="fa fa-check"></i><b>2.7</b> Videos</a></li>
<li class="chapter" data-level="2.8" data-path="probability-review.html"><a href="probability-review.html#references"><i class="fa fa-check"></i><b>2.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-rstudio-rmarkdown.html"><a href="r-rstudio-rmarkdown.html"><i class="fa fa-check"></i><b>3</b> <code>R</code>, RStudio, RMarkdown</a><ul>
<li class="chapter" data-level="3.1" data-path="r-rstudio-rmarkdown.html"><a href="r-rstudio-rmarkdown.html#videos-1"><i class="fa fa-check"></i><b>3.1</b> Videos</a></li>
<li class="chapter" data-level="3.2" data-path="r-rstudio-rmarkdown.html"><a href="r-rstudio-rmarkdown.html#template"><i class="fa fa-check"></i><b>3.2</b> Template</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html"><i class="fa fa-check"></i><b>4</b> Modeling Basics in <code>R</code></a><ul>
<li class="chapter" data-level="4.1" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#visualization-for-regression"><i class="fa fa-check"></i><b>4.1</b> Visualization for Regression</a></li>
<li class="chapter" data-level="4.2" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#the-lm-function"><i class="fa fa-check"></i><b>4.2</b> The <code>lm()</code> Function</a></li>
<li class="chapter" data-level="4.3" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#hypothesis-testing"><i class="fa fa-check"></i><b>4.3</b> Hypothesis Testing</a></li>
<li class="chapter" data-level="4.4" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#prediction"><i class="fa fa-check"></i><b>4.4</b> Prediction</a></li>
<li class="chapter" data-level="4.5" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#unusual-observations"><i class="fa fa-check"></i><b>4.5</b> Unusual Observations</a></li>
<li class="chapter" data-level="4.6" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#adding-complexity"><i class="fa fa-check"></i><b>4.6</b> Adding Complexity</a><ul>
<li class="chapter" data-level="4.6.1" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#interactions"><i class="fa fa-check"></i><b>4.6.1</b> Interactions</a></li>
<li class="chapter" data-level="4.6.2" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#polynomials"><i class="fa fa-check"></i><b>4.6.2</b> Polynomials</a></li>
<li class="chapter" data-level="4.6.3" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#transformations"><i class="fa fa-check"></i><b>4.6.3</b> Transformations</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="modeling-basics-in-r.html"><a href="modeling-basics-in-r.html#rmarkdown"><i class="fa fa-check"></i><b>4.7</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="part"><span><b>II Regression</b></span></li>
<li class="chapter" data-level="5" data-path="regression-overview.html"><a href="regression-overview.html"><i class="fa fa-check"></i><b>5</b> Overview</a><ul>
<li class="chapter" data-level="5.1" data-path="regression-overview.html"><a href="regression-overview.html#regression-notation"><i class="fa fa-check"></i><b>5.1</b> Regression Notation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="linear-models.html"><a href="linear-models.html"><i class="fa fa-check"></i><b>6</b> Linear Models</a><ul>
<li class="chapter" data-level="6.1" data-path="linear-models.html"><a href="linear-models.html#assesing-model-accuracy"><i class="fa fa-check"></i><b>6.1</b> Assesing Model Accuracy</a></li>
<li class="chapter" data-level="6.2" data-path="linear-models.html"><a href="linear-models.html#model-complexity"><i class="fa fa-check"></i><b>6.2</b> Model Complexity</a></li>
<li class="chapter" data-level="6.3" data-path="linear-models.html"><a href="linear-models.html#test-train-split"><i class="fa fa-check"></i><b>6.3</b> Test-Train Split</a></li>
<li class="chapter" data-level="6.4" data-path="linear-models.html"><a href="linear-models.html#adding-flexibility-to-linear-models"><i class="fa fa-check"></i><b>6.4</b> Adding Flexibility to Linear Models</a></li>
<li class="chapter" data-level="6.5" data-path="linear-models.html"><a href="linear-models.html#choosing-a-model"><i class="fa fa-check"></i><b>6.5</b> Choosing a Model</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="knn-reg.html"><a href="knn-reg.html"><i class="fa fa-check"></i><b>7</b> <span class="math inline">\(k\)</span>-Nearest Neighbors</a><ul>
<li class="chapter" data-level="7.1" data-path="knn-reg.html"><a href="knn-reg.html#parametric-versus-non-parametric-models"><i class="fa fa-check"></i><b>7.1</b> Parametric versus Non-Parametric Models</a></li>
<li class="chapter" data-level="7.2" data-path="knn-reg.html"><a href="knn-reg.html#local-approaches"><i class="fa fa-check"></i><b>7.2</b> Local Approaches</a><ul>
<li class="chapter" data-level="7.2.1" data-path="knn-reg.html"><a href="knn-reg.html#neighbors"><i class="fa fa-check"></i><b>7.2.1</b> Neighbors</a></li>
<li class="chapter" data-level="7.2.2" data-path="knn-reg.html"><a href="knn-reg.html#neighborhoods"><i class="fa fa-check"></i><b>7.2.2</b> Neighborhoods</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="knn-reg.html"><a href="knn-reg.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>7.3</b> <span class="math inline">\(k\)</span>-Nearest Neighbors</a></li>
<li class="chapter" data-level="7.4" data-path="knn-reg.html"><a href="knn-reg.html#tuning-parameters-versus-model-parameters"><i class="fa fa-check"></i><b>7.4</b> Tuning Parameters versus Model Parameters</a></li>
<li class="chapter" data-level="7.5" data-path="knn-reg.html"><a href="knn-reg.html#knn-in-r"><i class="fa fa-check"></i><b>7.5</b> KNN in <code>R</code></a></li>
<li class="chapter" data-level="7.6" data-path="knn-reg.html"><a href="knn-reg.html#choosing-k"><i class="fa fa-check"></i><b>7.6</b> Choosing <span class="math inline">\(k\)</span></a></li>
<li class="chapter" data-level="7.7" data-path="knn-reg.html"><a href="knn-reg.html#linear-versus-non-linear"><i class="fa fa-check"></i><b>7.7</b> Linear versus Non-Linear</a></li>
<li class="chapter" data-level="7.8" data-path="knn-reg.html"><a href="knn-reg.html#scaling-data"><i class="fa fa-check"></i><b>7.8</b> Scaling Data</a></li>
<li class="chapter" data-level="7.9" data-path="knn-reg.html"><a href="knn-reg.html#curse-of-dimensionality"><i class="fa fa-check"></i><b>7.9</b> Curse of Dimensionality</a></li>
<li class="chapter" data-level="7.10" data-path="knn-reg.html"><a href="knn-reg.html#train-time-versus-test-time"><i class="fa fa-check"></i><b>7.10</b> Train Time versus Test Time</a></li>
<li class="chapter" data-level="7.11" data-path="knn-reg.html"><a href="knn-reg.html#interpretability"><i class="fa fa-check"></i><b>7.11</b> Interpretability</a></li>
<li class="chapter" data-level="7.12" data-path="knn-reg.html"><a href="knn-reg.html#data-example"><i class="fa fa-check"></i><b>7.12</b> Data Example</a></li>
<li class="chapter" data-level="7.13" data-path="knn-reg.html"><a href="knn-reg.html#rmarkdown-1"><i class="fa fa-check"></i><b>7.13</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="biasvariance-tradeoff.html"><a href="biasvariance-tradeoff.html"><i class="fa fa-check"></i><b>8</b> Bias–Variance Tradeoff</a><ul>
<li class="chapter" data-level="8.1" data-path="biasvariance-tradeoff.html"><a href="biasvariance-tradeoff.html#reducible-and-irreducible-error"><i class="fa fa-check"></i><b>8.1</b> Reducible and Irreducible Error</a></li>
<li class="chapter" data-level="8.2" data-path="biasvariance-tradeoff.html"><a href="biasvariance-tradeoff.html#bias-variance-decomposition"><i class="fa fa-check"></i><b>8.2</b> Bias-Variance Decomposition</a></li>
<li class="chapter" data-level="8.3" data-path="biasvariance-tradeoff.html"><a href="biasvariance-tradeoff.html#simulation"><i class="fa fa-check"></i><b>8.3</b> Simulation</a></li>
<li class="chapter" data-level="8.4" data-path="biasvariance-tradeoff.html"><a href="biasvariance-tradeoff.html#estimating-expected-prediction-error"><i class="fa fa-check"></i><b>8.4</b> Estimating Expected Prediction Error</a></li>
<li class="chapter" data-level="8.5" data-path="biasvariance-tradeoff.html"><a href="biasvariance-tradeoff.html#rmarkdown-2"><i class="fa fa-check"></i><b>8.5</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="part"><span><b>III Classification</b></span></li>
<li class="chapter" data-level="9" data-path="classification-overview.html"><a href="classification-overview.html"><i class="fa fa-check"></i><b>9</b> Overview</a><ul>
<li class="chapter" data-level="9.1" data-path="classification-overview.html"><a href="classification-overview.html#visualization-for-classification"><i class="fa fa-check"></i><b>9.1</b> Visualization for Classification</a></li>
<li class="chapter" data-level="9.2" data-path="classification-overview.html"><a href="classification-overview.html#a-simple-classifier"><i class="fa fa-check"></i><b>9.2</b> A Simple Classifier</a></li>
<li class="chapter" data-level="9.3" data-path="classification-overview.html"><a href="classification-overview.html#metrics-for-classification"><i class="fa fa-check"></i><b>9.3</b> Metrics for Classification</a></li>
<li class="chapter" data-level="9.4" data-path="classification-overview.html"><a href="classification-overview.html#rmarkdown-3"><i class="fa fa-check"></i><b>9.4</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>10</b> Logistic Regression</a><ul>
<li class="chapter" data-level="10.1" data-path="logistic-regression.html"><a href="logistic-regression.html#linear-regression"><i class="fa fa-check"></i><b>10.1</b> Linear Regression</a></li>
<li class="chapter" data-level="10.2" data-path="logistic-regression.html"><a href="logistic-regression.html#bayes-classifier"><i class="fa fa-check"></i><b>10.2</b> Bayes Classifier</a></li>
<li class="chapter" data-level="10.3" data-path="logistic-regression.html"><a href="logistic-regression.html#logistic-regression-with-glm"><i class="fa fa-check"></i><b>10.3</b> Logistic Regression with <code>glm()</code></a></li>
<li class="chapter" data-level="10.4" data-path="logistic-regression.html"><a href="logistic-regression.html#roc-curves"><i class="fa fa-check"></i><b>10.4</b> ROC Curves</a></li>
<li class="chapter" data-level="10.5" data-path="logistic-regression.html"><a href="logistic-regression.html#multinomial-logistic-regression"><i class="fa fa-check"></i><b>10.5</b> Multinomial Logistic Regression</a></li>
<li class="chapter" data-level="10.6" data-path="logistic-regression.html"><a href="logistic-regression.html#rmarkdown-4"><i class="fa fa-check"></i><b>10.6</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="generative-models.html"><a href="generative-models.html"><i class="fa fa-check"></i><b>11</b> Generative Models</a><ul>
<li class="chapter" data-level="11.1" data-path="generative-models.html"><a href="generative-models.html#linear-discriminant-analysis"><i class="fa fa-check"></i><b>11.1</b> Linear Discriminant Analysis</a></li>
<li class="chapter" data-level="11.2" data-path="generative-models.html"><a href="generative-models.html#quadratic-discriminant-analysis"><i class="fa fa-check"></i><b>11.2</b> Quadratic Discriminant Analysis</a></li>
<li class="chapter" data-level="11.3" data-path="generative-models.html"><a href="generative-models.html#naive-bayes"><i class="fa fa-check"></i><b>11.3</b> Naive Bayes</a></li>
<li class="chapter" data-level="11.4" data-path="generative-models.html"><a href="generative-models.html#discrete-inputs"><i class="fa fa-check"></i><b>11.4</b> Discrete Inputs</a></li>
<li class="chapter" data-level="11.5" data-path="generative-models.html"><a href="generative-models.html#rmarkdown-5"><i class="fa fa-check"></i><b>11.5</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="knn-class.html"><a href="knn-class.html"><i class="fa fa-check"></i><b>12</b> k-Nearest Neighbors</a><ul>
<li class="chapter" data-level="12.1" data-path="knn-class.html"><a href="knn-class.html#binary-data-example"><i class="fa fa-check"></i><b>12.1</b> Binary Data Example</a></li>
<li class="chapter" data-level="12.2" data-path="knn-class.html"><a href="knn-class.html#categorical-data"><i class="fa fa-check"></i><b>12.2</b> Categorical Data</a></li>
<li class="chapter" data-level="12.3" data-path="knn-class.html"><a href="knn-class.html#external-links"><i class="fa fa-check"></i><b>12.3</b> External Links</a></li>
<li class="chapter" data-level="12.4" data-path="knn-class.html"><a href="knn-class.html#rmarkdown-6"><i class="fa fa-check"></i><b>12.4</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="part"><span><b>IV Unsupervised Learning</b></span></li>
<li class="chapter" data-level="13" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html"><i class="fa fa-check"></i><b>13</b> Overview</a><ul>
<li class="chapter" data-level="13.1" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#methods"><i class="fa fa-check"></i><b>13.1</b> Methods</a><ul>
<li class="chapter" data-level="13.1.1" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#principal-component-analysis"><i class="fa fa-check"></i><b>13.1.1</b> Principal Component Analysis</a></li>
<li class="chapter" data-level="13.1.2" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#k-means-clustering"><i class="fa fa-check"></i><b>13.1.2</b> <span class="math inline">\(k\)</span>-Means Clustering</a></li>
<li class="chapter" data-level="13.1.3" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#hierarchical-clustering"><i class="fa fa-check"></i><b>13.1.3</b> Hierarchical Clustering</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#examples"><i class="fa fa-check"></i><b>13.2</b> Examples</a><ul>
<li class="chapter" data-level="13.2.1" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#us-arrests"><i class="fa fa-check"></i><b>13.2.1</b> US Arrests</a></li>
<li class="chapter" data-level="13.2.2" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#simulated-data"><i class="fa fa-check"></i><b>13.2.2</b> Simulated Data</a></li>
<li class="chapter" data-level="13.2.3" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#iris-data"><i class="fa fa-check"></i><b>13.2.3</b> Iris Data</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#external-links-1"><i class="fa fa-check"></i><b>13.3</b> External Links</a></li>
<li class="chapter" data-level="13.4" data-path="unsupervised-overview.html"><a href="unsupervised-overview.html#rmarkdown-7"><i class="fa fa-check"></i><b>13.4</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="principal-component-analysis-1.html"><a href="principal-component-analysis-1.html"><i class="fa fa-check"></i><b>14</b> Principal Component Analysis</a></li>
<li class="chapter" data-level="15" data-path="k-means.html"><a href="k-means.html"><i class="fa fa-check"></i><b>15</b> k-Means</a></li>
<li class="chapter" data-level="16" data-path="mixture-models.html"><a href="mixture-models.html"><i class="fa fa-check"></i><b>16</b> Mixture Models</a></li>
<li class="chapter" data-level="17" data-path="hierarchical-clustering-1.html"><a href="hierarchical-clustering-1.html"><i class="fa fa-check"></i><b>17</b> Hierarchical Clustering</a></li>
<li class="part"><span><b>V In Practice</b></span></li>
<li class="chapter" data-level="18" data-path="practice-overview.html"><a href="practice-overview.html"><i class="fa fa-check"></i><b>18</b> Overview</a></li>
<li class="chapter" data-level="19" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html"><i class="fa fa-check"></i><b>19</b> Supervised Learning Overview</a><ul>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#bayes-classifier-1"><i class="fa fa-check"></i>Bayes Classifier</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#the-bias-variance-tradeoff"><i class="fa fa-check"></i>The Bias-Variance Tradeoff</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#the-test-train-split"><i class="fa fa-check"></i>The Test-Train Split</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#classification-methods"><i class="fa fa-check"></i>Classification Methods</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#discriminative-versus-generative-methods"><i class="fa fa-check"></i>Discriminative versus Generative Methods</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#parametric-and-non-parametric-methods"><i class="fa fa-check"></i>Parametric and Non-Parametric Methods</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#tuning-parameters"><i class="fa fa-check"></i>Tuning Parameters</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#cross-validation"><i class="fa fa-check"></i>Cross-Validation</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#curse-of-dimensionality-1"><i class="fa fa-check"></i>Curse of Dimensionality</a></li>
<li class="chapter" data-level="" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#no-free-lunch-theorem"><i class="fa fa-check"></i>No-Free-Lunch Theorem</a></li>
<li class="chapter" data-level="19.1" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#external-links-2"><i class="fa fa-check"></i><b>19.1</b> External Links</a></li>
<li class="chapter" data-level="19.2" data-path="supervised-learning-overview.html"><a href="supervised-learning-overview.html#rmarkdown-8"><i class="fa fa-check"></i><b>19.2</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="resampling.html"><a href="resampling.html"><i class="fa fa-check"></i><b>20</b> Resampling</a><ul>
<li class="chapter" data-level="20.1" data-path="resampling.html"><a href="resampling.html#validation-set-approach"><i class="fa fa-check"></i><b>20.1</b> Validation-Set Approach</a></li>
<li class="chapter" data-level="20.2" data-path="resampling.html"><a href="resampling.html#cross-validation-1"><i class="fa fa-check"></i><b>20.2</b> Cross-Validation</a></li>
<li class="chapter" data-level="20.3" data-path="resampling.html"><a href="resampling.html#test-data"><i class="fa fa-check"></i><b>20.3</b> Test Data</a></li>
<li class="chapter" data-level="20.4" data-path="resampling.html"><a href="resampling.html#bootstrap"><i class="fa fa-check"></i><b>20.4</b> Bootstrap</a></li>
<li class="chapter" data-level="20.5" data-path="resampling.html"><a href="resampling.html#which-k"><i class="fa fa-check"></i><b>20.5</b> Which <span class="math inline">\(K\)</span>?</a></li>
<li class="chapter" data-level="20.6" data-path="resampling.html"><a href="resampling.html#summary"><i class="fa fa-check"></i><b>20.6</b> Summary</a></li>
<li class="chapter" data-level="20.7" data-path="resampling.html"><a href="resampling.html#external-links-3"><i class="fa fa-check"></i><b>20.7</b> External Links</a></li>
<li class="chapter" data-level="20.8" data-path="resampling.html"><a href="resampling.html#rmarkdown-9"><i class="fa fa-check"></i><b>20.8</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="the-caret-package.html"><a href="the-caret-package.html"><i class="fa fa-check"></i><b>21</b> The <code>caret</code> Package</a><ul>
<li class="chapter" data-level="21.1" data-path="the-caret-package.html"><a href="the-caret-package.html#classification"><i class="fa fa-check"></i><b>21.1</b> Classification</a><ul>
<li class="chapter" data-level="21.1.1" data-path="the-caret-package.html"><a href="the-caret-package.html#tuning"><i class="fa fa-check"></i><b>21.1.1</b> Tuning</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="the-caret-package.html"><a href="the-caret-package.html#regression"><i class="fa fa-check"></i><b>21.2</b> Regression</a><ul>
<li class="chapter" data-level="21.2.1" data-path="the-caret-package.html"><a href="the-caret-package.html#methods-1"><i class="fa fa-check"></i><b>21.2.1</b> Methods</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="the-caret-package.html"><a href="the-caret-package.html#external-links-4"><i class="fa fa-check"></i><b>21.3</b> External Links</a></li>
<li class="chapter" data-level="21.4" data-path="the-caret-package.html"><a href="the-caret-package.html#rmarkdown-10"><i class="fa fa-check"></i><b>21.4</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="subset-selection.html"><a href="subset-selection.html"><i class="fa fa-check"></i><b>22</b> Subset Selection</a><ul>
<li class="chapter" data-level="22.1" data-path="subset-selection.html"><a href="subset-selection.html#aic-bic-and-cp"><i class="fa fa-check"></i><b>22.1</b> AIC, BIC, and Cp</a><ul>
<li class="chapter" data-level="22.1.1" data-path="subset-selection.html"><a href="subset-selection.html#leaps-package"><i class="fa fa-check"></i><b>22.1.1</b> <code>leaps</code> Package</a></li>
<li class="chapter" data-level="22.1.2" data-path="subset-selection.html"><a href="subset-selection.html#best-subset"><i class="fa fa-check"></i><b>22.1.2</b> Best Subset</a></li>
<li class="chapter" data-level="22.1.3" data-path="subset-selection.html"><a href="subset-selection.html#stepwise-methods"><i class="fa fa-check"></i><b>22.1.3</b> Stepwise Methods</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="subset-selection.html"><a href="subset-selection.html#validated-rmse"><i class="fa fa-check"></i><b>22.2</b> Validated RMSE</a></li>
<li class="chapter" data-level="22.3" data-path="subset-selection.html"><a href="subset-selection.html#external-links-5"><i class="fa fa-check"></i><b>22.3</b> External Links</a></li>
<li class="chapter" data-level="22.4" data-path="subset-selection.html"><a href="subset-selection.html#rmarkdown-11"><i class="fa fa-check"></i><b>22.4</b> RMarkdown</a></li>
</ul></li>
<li class="part"><span><b>VI The Modern Era</b></span></li>
<li class="chapter" data-level="23" data-path="modern-overview.html"><a href="modern-overview.html"><i class="fa fa-check"></i><b>23</b> Overview</a></li>
<li class="chapter" data-level="24" data-path="regularization.html"><a href="regularization.html"><i class="fa fa-check"></i><b>24</b> Regularization</a><ul>
<li class="chapter" data-level="24.1" data-path="regularization.html"><a href="regularization.html#ridge-regression"><i class="fa fa-check"></i><b>24.1</b> Ridge Regression</a></li>
<li class="chapter" data-level="24.2" data-path="regularization.html"><a href="regularization.html#lasso"><i class="fa fa-check"></i><b>24.2</b> Lasso</a></li>
<li class="chapter" data-level="24.3" data-path="regularization.html"><a href="regularization.html#broom"><i class="fa fa-check"></i><b>24.3</b> <code>broom</code></a></li>
<li class="chapter" data-level="24.4" data-path="regularization.html"><a href="regularization.html#simulated-data-p-n"><i class="fa fa-check"></i><b>24.4</b> Simulated Data, <span class="math inline">\(p &gt; n\)</span></a></li>
<li class="chapter" data-level="24.5" data-path="regularization.html"><a href="regularization.html#external-links-6"><i class="fa fa-check"></i><b>24.5</b> External Links</a></li>
<li class="chapter" data-level="24.6" data-path="regularization.html"><a href="regularization.html#rmarkdown-12"><i class="fa fa-check"></i><b>24.6</b> <code>rmarkdown</code></a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="elastic-net.html"><a href="elastic-net.html"><i class="fa fa-check"></i><b>25</b> Elastic Net</a><ul>
<li class="chapter" data-level="25.1" data-path="elastic-net.html"><a href="elastic-net.html#hitters-data"><i class="fa fa-check"></i><b>25.1</b> Hitters Data</a></li>
<li class="chapter" data-level="25.2" data-path="elastic-net.html"><a href="elastic-net.html#elastic-net-for-regression"><i class="fa fa-check"></i><b>25.2</b> Elastic Net for Regression</a></li>
<li class="chapter" data-level="25.3" data-path="elastic-net.html"><a href="elastic-net.html#elastic-net-for-classification"><i class="fa fa-check"></i><b>25.3</b> Elastic Net for Classification</a></li>
<li class="chapter" data-level="25.4" data-path="elastic-net.html"><a href="elastic-net.html#external-links-7"><i class="fa fa-check"></i><b>25.4</b> External Links</a></li>
<li class="chapter" data-level="25.5" data-path="elastic-net.html"><a href="elastic-net.html#rmarkdown-13"><i class="fa fa-check"></i><b>25.5</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="trees.html"><a href="trees.html"><i class="fa fa-check"></i><b>26</b> Trees</a><ul>
<li class="chapter" data-level="26.1" data-path="trees.html"><a href="trees.html#classification-trees"><i class="fa fa-check"></i><b>26.1</b> Classification Trees</a></li>
<li class="chapter" data-level="26.2" data-path="trees.html"><a href="trees.html#regression-trees"><i class="fa fa-check"></i><b>26.2</b> Regression Trees</a></li>
<li class="chapter" data-level="26.3" data-path="trees.html"><a href="trees.html#rpart-package"><i class="fa fa-check"></i><b>26.3</b> <code>rpart</code> Package</a></li>
<li class="chapter" data-level="26.4" data-path="trees.html"><a href="trees.html#external-links-8"><i class="fa fa-check"></i><b>26.4</b> External Links</a></li>
<li class="chapter" data-level="26.5" data-path="trees.html"><a href="trees.html#rmarkdown-14"><i class="fa fa-check"></i><b>26.5</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="ensemble-methods.html"><a href="ensemble-methods.html"><i class="fa fa-check"></i><b>27</b> Ensemble Methods</a><ul>
<li class="chapter" data-level="27.1" data-path="ensemble-methods.html"><a href="ensemble-methods.html#regression-1"><i class="fa fa-check"></i><b>27.1</b> Regression</a><ul>
<li class="chapter" data-level="27.1.1" data-path="ensemble-methods.html"><a href="ensemble-methods.html#tree-model"><i class="fa fa-check"></i><b>27.1.1</b> Tree Model</a></li>
<li class="chapter" data-level="27.1.2" data-path="ensemble-methods.html"><a href="ensemble-methods.html#linear-model"><i class="fa fa-check"></i><b>27.1.2</b> Linear Model</a></li>
<li class="chapter" data-level="27.1.3" data-path="ensemble-methods.html"><a href="ensemble-methods.html#bagging"><i class="fa fa-check"></i><b>27.1.3</b> Bagging</a></li>
<li class="chapter" data-level="27.1.4" data-path="ensemble-methods.html"><a href="ensemble-methods.html#random-forest"><i class="fa fa-check"></i><b>27.1.4</b> Random Forest</a></li>
<li class="chapter" data-level="27.1.5" data-path="ensemble-methods.html"><a href="ensemble-methods.html#boosting"><i class="fa fa-check"></i><b>27.1.5</b> Boosting</a></li>
<li class="chapter" data-level="27.1.6" data-path="ensemble-methods.html"><a href="ensemble-methods.html#results"><i class="fa fa-check"></i><b>27.1.6</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="27.2" data-path="ensemble-methods.html"><a href="ensemble-methods.html#classification-1"><i class="fa fa-check"></i><b>27.2</b> Classification</a><ul>
<li class="chapter" data-level="27.2.1" data-path="ensemble-methods.html"><a href="ensemble-methods.html#tree-model-1"><i class="fa fa-check"></i><b>27.2.1</b> Tree Model</a></li>
<li class="chapter" data-level="27.2.2" data-path="ensemble-methods.html"><a href="ensemble-methods.html#logistic-regression-1"><i class="fa fa-check"></i><b>27.2.2</b> Logistic Regression</a></li>
<li class="chapter" data-level="27.2.3" data-path="ensemble-methods.html"><a href="ensemble-methods.html#bagging-1"><i class="fa fa-check"></i><b>27.2.3</b> Bagging</a></li>
<li class="chapter" data-level="27.2.4" data-path="ensemble-methods.html"><a href="ensemble-methods.html#random-forest-1"><i class="fa fa-check"></i><b>27.2.4</b> Random Forest</a></li>
<li class="chapter" data-level="27.2.5" data-path="ensemble-methods.html"><a href="ensemble-methods.html#boosting-1"><i class="fa fa-check"></i><b>27.2.5</b> Boosting</a></li>
<li class="chapter" data-level="27.2.6" data-path="ensemble-methods.html"><a href="ensemble-methods.html#results-1"><i class="fa fa-check"></i><b>27.2.6</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="27.3" data-path="ensemble-methods.html"><a href="ensemble-methods.html#tuning-1"><i class="fa fa-check"></i><b>27.3</b> Tuning</a><ul>
<li class="chapter" data-level="27.3.1" data-path="ensemble-methods.html"><a href="ensemble-methods.html#random-forest-and-bagging"><i class="fa fa-check"></i><b>27.3.1</b> Random Forest and Bagging</a></li>
<li class="chapter" data-level="27.3.2" data-path="ensemble-methods.html"><a href="ensemble-methods.html#boosting-2"><i class="fa fa-check"></i><b>27.3.2</b> Boosting</a></li>
</ul></li>
<li class="chapter" data-level="27.4" data-path="ensemble-methods.html"><a href="ensemble-methods.html#tree-versus-ensemble-boundaries"><i class="fa fa-check"></i><b>27.4</b> Tree versus Ensemble Boundaries</a></li>
<li class="chapter" data-level="27.5" data-path="ensemble-methods.html"><a href="ensemble-methods.html#external-links-9"><i class="fa fa-check"></i><b>27.5</b> External Links</a></li>
<li class="chapter" data-level="27.6" data-path="ensemble-methods.html"><a href="ensemble-methods.html#rmarkdown-15"><i class="fa fa-check"></i><b>27.6</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="artificial-neural-networks.html"><a href="artificial-neural-networks.html"><i class="fa fa-check"></i><b>28</b> Artificial Neural Networks</a></li>
<li class="part"><span><b>VII Appendix</b></span></li>
<li class="chapter" data-level="29" data-path="appendix-overview.html"><a href="appendix-overview.html"><i class="fa fa-check"></i><b>29</b> Overview</a></li>
<li class="chapter" data-level="30" data-path="non-linear-models.html"><a href="non-linear-models.html"><i class="fa fa-check"></i><b>30</b> Non-Linear Models</a></li>
<li class="chapter" data-level="31" data-path="regularized-discriminant-analysis.html"><a href="regularized-discriminant-analysis.html"><i class="fa fa-check"></i><b>31</b> Regularized Discriminant Analysis</a></li>
<li class="chapter" data-level="32" data-path="support-vector-machines.html"><a href="support-vector-machines.html"><i class="fa fa-check"></i><b>32</b> Support Vector Machines</a></li>
<li class="divider"></li>
<li><a href="https://github.com/daviddalpiaz/r4sl" target="blank">&copy; 2017 David Dalpiaz</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><code>R</code> for Statistical Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-caret-package" class="section level1">
<h1><span class="header-section-number">Chapter 21</span> The <code>caret</code> Package</h1>
<p>Now that we have seen a number of classification and regression methods, and introduced cross-validation, we see the general outline of a predictive analysis:</p>
<ul>
<li>Test-train split the available data
<ul>
<li>Consider a method
<ul>
<li>Decide on a set of candidate models (specify possible tuning parameters for method)</li>
<li>Use resampling to find the “best model” by choosing the values of the tuning parameters</li>
</ul></li>
<li>Use chosen model to make predictions</li>
<li>Calculate relevant metrics on the test data</li>
</ul></li>
</ul>
<p>At face value it would seem like it should be easy to repeat this process for a number of different methods, however we have run into a number of difficulties attempting to do so with <code>R</code>.</p>
<ul>
<li>The <code>predict()</code> function seems to have a different behavior for each new method we see.</li>
<li>Many methods have different cross-validation functions, or worse yet, no built-in process for cross-validation.</li>
<li>Not all methods expect the same data format. Some methods do not use formula syntax.</li>
<li>Different methods have different handling of categorical predictors. Some methods cannot handle factor variables.</li>
</ul>
<p>Thankfully, the <code>R</code> community has essentially provided a silver bullet for these issues, the <a href="http://topepo.github.io/caret/"><code>caret</code></a> package. Returning to the above list, we will see that a number of these tasks are directly addressed in the <code>caret</code> package.</p>
<ul>
<li>Test-train split the available data
<ul>
<li><code>createDataPartition()</code> will take the place of our manual data splitting. It will also do some extra work to ensure that the train and test samples are somewhat similar.</li>
</ul></li>
<li>Specify possible tuning parameters for method
<ul>
<li><code>expand.grid()</code> is not a function in <code>caret</code>, but we will get in the habit of using it to specify a grid of tuning parameters.</li>
</ul></li>
<li>Use resampling to find the “best model” by choosing the values of the tuning parameters
<ul>
<li><code>trainControl()</code> will specify the resampling scheme</li>
<li><code>train()</code> is the workhorse of <code>caret</code>. It takes the following information then trains (tunes) the requested model:
<ul>
<li><code>form</code>, a formula, such as <code>y ~ .</code>
<ul>
<li>This specifies the response and which predictors (or transformations of) should be used.</li>
</ul></li>
<li><code>data</code>, the data used for training</li>
<li><code>trControl</code> which specifies the resampling scheme, that is, how cross-validation should be performed to find the best values of the tuning parameters</li>
<li><code>preProcess</code> which allows for specification of data pre-processing such as centering and scaling</li>
<li><code>method</code>, a statistical learning method from <a href="https://topepo.github.io/caret/available-models.html">a long list of availible models</a></li>
<li><code>tuneGrid</code> which specifies the tuning parameters to train over</li>
</ul></li>
</ul></li>
<li>Use chosen model to make predictions
<ul>
<li><code>predict()</code> used on objects of type <code>train</code> will be truly magical!</li>
</ul></li>
</ul>
<div id="classification" class="section level2">
<h2><span class="header-section-number">21.1</span> Classification</h2>
<p>To illustrate <code>caret</code>, first for classification, we will use the <code>Default</code> data from the <code>ISLR</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(Default, <span class="dt">package =</span> <span class="st">&quot;ISLR&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(caret)</code></pre></div>
<p>We first test-train split the data using <code>createDataPartition</code>. Here we are using 75% of the data for training.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">430</span>)
default_idx =<span class="st"> </span><span class="kw">createDataPartition</span>(Default$default, <span class="dt">p =</span> <span class="fl">0.75</span>, <span class="dt">list =</span> <span class="ot">FALSE</span>)
default_trn =<span class="st"> </span>Default[default_idx, ]
default_tst =<span class="st"> </span>Default[-default_idx, ]</code></pre></div>
<p>At first glance, it might appear as if the use of <code>createDataPartition()</code> is no different than our previous use of <code>sample()</code>. However, <code>createDataPartition()</code> tries to ensure a split that has a similar distribution of the supplied variable in both datasets. See the documentation for details.</p>
<p>After splitting the data, we can begin training a number of models. We begin with a simple additive logistic regression.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">default_glm_mod =<span class="st"> </span><span class="kw">train</span>(
  <span class="dt">form =</span> default ~<span class="st"> </span>.,
  <span class="dt">data =</span> default_trn,
  <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>),
  <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,
  <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>
)</code></pre></div>
<p>Here, we have supplied four arguments to the <code>train()</code> function form the <code>caret</code> package.</p>
<ul>
<li><code>form = default ~ .</code> specifies the <code>default</code> variable as the response. It also indicates that all available predictors should be used.</li>
<li><code>data = default_trn</code> specifies that training will be down with the <code>default_trn</code> data</li>
<li><code>trControl = trainControl(method = &quot;cv&quot;, number = 5)</code> specifies that we will be using 5-fold cross-validation.</li>
<li><code>method = glm</code> specifies that we will fit a generalized linear model.</li>
</ul>
<p>The <code>method</code> essentially specifies both the model (and more specifically the function to fit said model in <code>R</code>) and package that will be used. The <code>train()</code> function is essentially a wrapper around whatever method we chose. In this case, the function is the base <code>R</code> function <code>glm()</code>, so no additional package is required. When a method requires a function from a certain package, that package will need to be installed. See the <a href="https://topepo.github.io/caret/available-models.html">list of availible models</a> for package information.</p>
<p>The list that we have passed to the <code>trControl</code> argument is created using the <code>trainControl()</code> function from <code>caret</code>. The <code>trainControl()</code> function is a powerful tool for specifying a number of the training choices required by <code>train()</code>, in particular the resampling scheme.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>)[<span class="dv">1</span>:<span class="dv">3</span>]</code></pre></div>
<pre><code>## $method
## [1] &quot;cv&quot;
## 
## $number
## [1] 5
## 
## $repeats
## [1] NA</code></pre>
<p>Here we see just the first three elements of this list, which are related to how the resampling will be done. These are the three elements that we will be most interested in. Here, only the first two are relevant.</p>
<ul>
<li><code>method</code> specifies how resampling will be done. Examples include <code>cv</code>, <code>boot</code>, <code>LOOCV</code>, <code>repeatedcv</code>, and <code>oob</code>.</li>
<li><code>number</code> specifies the number of times resampling should be done for methods that require resample, such as, <code>cv</code> and <code>boot</code>.</li>
<li><code>repeats</code> specifies the number of times to repeat resampling for methods such as <code>repeatedcv</code></li>
</ul>
<p>For details on the full capabilities of this function, see the relevant documentation. The out-of-bag, <code>oob</code> which is a sort of automatic resampling for certain statistical learning methods, will be introduced later.</p>
<p>We’ve also passed an additional argument of <code>&quot;binomial&quot;</code> to <code>family</code>. This isn’t actually an argument for <code>train()</code>, but an additional argument for the method <code>glm</code>. In actuality, we don’t need to specify the family. Since <code>default</code> is a factor variable, <code>caret</code> automatically detects that we are trying to perform classification, and would automatically use <code>family = &quot;binomial&quot;</code>. This isn’t the case if we were simply using <code>glm()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">default_glm_mod</code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 7501 samples
##    3 predictor
##    2 classes: &#39;No&#39;, &#39;Yes&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 6001, 6001, 6000, 6001, 6001 
## Resampling results:
## 
##   Accuracy   Kappa    
##   0.9733372  0.4174282</code></pre>
<p>Called the stored <code>train()</code> object summarizes the training that we have done. We see that we used 7501 observations that had a binary class response and three predictors. We have not done any data pre-processing, and have utilized 5-fold cross-validation. The cross-validated accuracy is reported. Note that, <code>caret</code> is an optimist, and prefers to report accuracy (proportion of correct classifications) instead of the error that we often considered before (proportion of incorrect classifications).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(default_glm_mod)</code></pre></div>
<pre><code>##  [1] &quot;method&quot;       &quot;modelInfo&quot;    &quot;modelType&quot;    &quot;results&quot;     
##  [5] &quot;pred&quot;         &quot;bestTune&quot;     &quot;call&quot;         &quot;dots&quot;        
##  [9] &quot;metric&quot;       &quot;control&quot;      &quot;finalModel&quot;   &quot;preProcess&quot;  
## [13] &quot;trainingData&quot; &quot;resample&quot;     &quot;resampledCM&quot;  &quot;perfNames&quot;   
## [17] &quot;maximize&quot;     &quot;yLimits&quot;      &quot;times&quot;        &quot;levels&quot;      
## [21] &quot;terms&quot;        &quot;coefnames&quot;    &quot;contrasts&quot;    &quot;xlevels&quot;</code></pre>
<p>We see that there is a wealth of information stored in the list returned by <code>train()</code>. Two elements that we will often be interested in are <code>results</code> and <code>finalModel</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">default_glm_mod$results</code></pre></div>
<pre><code>##   parameter  Accuracy     Kappa AccuracySD   KappaSD
## 1      none 0.9733372 0.4174282 0.00358649 0.1180854</code></pre>
<p>The <code>resutls</code> show some more detailed results, in particular <code>AccuracySD</code> which gives us an estimate of the uncertainty in our accuracy estimate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">default_glm_mod$finalModel</code></pre></div>
<pre><code>## 
## Call:  NULL
## 
## Coefficients:
## (Intercept)   studentYes      balance       income  
##  -1.066e+01   -6.254e-01    5.647e-03    1.395e-06  
## 
## Degrees of Freedom: 7500 Total (i.e. Null);  7497 Residual
## Null Deviance:       2192 
## Residual Deviance: 1204  AIC: 1212</code></pre>
<p>The <code>finalModel</code> is a model object, in this case, the object returned from <code>glm()</code>. This final model, is fit to all of the supplied training data. This model object is often used when we call certain relevant functions on the object returned by <code>train()</code>, such as <code>summary()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(default_glm_mod)</code></pre></div>
<pre><code>## 
## Call:
## NULL
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.4350  -0.1486  -0.0588  -0.0218   3.7184  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.066e+01  5.509e-01 -19.353   &lt;2e-16 ***
## studentYes  -6.254e-01  2.702e-01  -2.315   0.0206 *  
## balance      5.647e-03  2.639e-04  21.401   &lt;2e-16 ***
## income       1.395e-06  9.300e-06   0.150   0.8808    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2192.2  on 7500  degrees of freedom
## Residual deviance: 1203.5  on 7497  degrees of freedom
## AIC: 1211.5
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<p>We see that this summary is what we had seen previously from objects of type <code>glm</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">calc_acc =<span class="st"> </span>function(actual, predicted) {
  <span class="kw">mean</span>(actual ==<span class="st"> </span>predicted)
}</code></pre></div>
<p>To obtain test accuracy, we will need to make predictions on the test data. With the object returned by <code>train()</code>, this is extremely easy.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">predict</span>(default_glm_mod, <span class="dt">newdata =</span> default_tst))</code></pre></div>
<pre><code>## [1] No No No No No No
## Levels: No Yes</code></pre>
<p>We see that by default, the <code>predict()</code> function is returning classifications. This will be true no matter what method we use!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># test acc</span>
<span class="kw">calc_acc</span>(<span class="dt">actual =</span> default_tst$default,
         <span class="dt">predicted =</span> <span class="kw">predict</span>(default_glm_mod, <span class="dt">newdata =</span> default_tst))</code></pre></div>
<pre><code>## [1] 0.9739896</code></pre>
<p>If instead of the default behavior of returning classifications, we instead wanted predicted probabilities, we simply specify <code>type = &quot;prob&quot;</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get probs</span>
<span class="kw">head</span>(<span class="kw">predict</span>(default_glm_mod, <span class="dt">newdata =</span> default_trn, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>))</code></pre></div>
<pre><code>##          No         Yes
## 1 0.9984674 0.001532637
## 3 0.9895850 0.010414985
## 5 0.9979141 0.002085863
## 6 0.9977233 0.002276746
## 8 0.9987645 0.001235527
## 9 0.9829081 0.017091877</code></pre>
<p>Notice that this returns the probabilities for all possible classes, in this case <code>No</code> and <code>Yes</code>. Again, this will be true for all methods! This is especially useful for multi-class data!.</p>
<div id="tuning" class="section level3">
<h3><span class="header-section-number">21.1.1</span> Tuning</h3>
<p>Since logistic regression has no tuning parameters, we haven’t really highlighted the full potential of <code>caret</code>. We’ve essentially used it to obtain cross-validated results, and for the more well-behaved <code>predict()</code> function. These are excellent improvements over our previous methods, but the real power of <code>caret</code> is its ability to provide a framework for tuning model.</p>
<p>To illustrate tuning, we now use <code>knn</code> as our method, which performs <span class="math inline">\(k\)</span>-nearest neighbors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">default_knn_mod =<span class="st"> </span><span class="kw">train</span>(
  default ~<span class="st"> </span>.,
  <span class="dt">data =</span> default_trn,
  <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>,
  <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>)
)</code></pre></div>
<p>First, note that we are using formula syntax here, where previously we needed to create separate response and predictors matrices. Also, we’re using a factor variable as a predictor, and <code>caret</code> seems to be taking care of this automatically.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">default_knn_mod</code></pre></div>
<pre><code>## k-Nearest Neighbors 
## 
## 7501 samples
##    3 predictor
##    2 classes: &#39;No&#39;, &#39;Yes&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 6001, 6000, 6001, 6001, 6001 
## Resampling results across tuning parameters:
## 
##   k  Accuracy   Kappa     
##   5  0.9660044  0.14910366
##   7  0.9654711  0.08890944
##   9  0.9660044  0.03400684
## 
## Accuracy was used to select the optimal model using  the largest value.
## The final value used for the model was k = 9.</code></pre>
<p>Here we are again using 5-fold cross-validation and no pre-processing. Notice that we now have multiple results, for <code>k = 5</code>, <code>k = 7</code>, and <code>k = 9</code>.</p>
<p>Let’s modifying this training by introducing pre-processing, and specifying our own tuning parameters, instead of the default values above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">default_knn_mod =<span class="st"> </span><span class="kw">train</span>(
  default ~<span class="st"> </span>.,
  <span class="dt">data =</span> default_trn,
  <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>,
  <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>),
  <span class="dt">preProcess =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>),
  <span class="dt">tuneGrid =</span> <span class="kw">expand.grid</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">101</span>, <span class="dt">by =</span> <span class="dv">2</span>))
)</code></pre></div>
<p>Here, we’ve specified that we would like to center and scale the data. Essentially transforming each predictor to have mean 0 and variance 1. The documentation on the <code>preProcess()</code> function provides examples of additional possible pre-processing. IN our call to <code>train()</code> we’re essentially specifying how we would like this function applied to our data.</p>
<p>We’ve also provided a “tuning grid,” in this case, the values of <code>k</code> to try. The <code>tuneGrid</code> argument expects a data frame, which <code>expand.grid()</code> returns. We don’t actually need <code>expand.grid()</code> for this example, but it will be a useful habit to develop when we move to methods with multiple tuning parameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(default_knn_mod$results, <span class="dv">5</span>)</code></pre></div>
<pre><code>##   k  Accuracy     Kappa  AccuracySD    KappaSD
## 1 1 0.9556062 0.2980896 0.003446167 0.04848084
## 2 3 0.9676048 0.3753023 0.002959213 0.04629315
## 3 5 0.9701374 0.4040223 0.001442498 0.04092678
## 4 7 0.9706704 0.3906642 0.001567466 0.05200146
## 5 9 0.9720034 0.4091064 0.001706297 0.05361118</code></pre>
<p>Since how we have a large number of results, display the entire <code>results</code> would create a lot of clutter. Instead, we can plot the tuning results by calling <code>plot()</code> on the object returned by <code>train()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(default_knn_mod)</code></pre></div>
<p><img src="21-caret_files/figure-html/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>By default, <code>caret</code> utilizes the <code>lattice</code> graphics package to create these plots. Recently, additional support for <code>ggplot2</code> style graphics has been added for some plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(default_knn_mod) +<span class="st"> </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="21-caret_files/figure-html/unnamed-chunk-20-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Now that we are dealing with a tuning parameter, <code>train()</code> determines the best value of those considered, by default selecting the best (highest cross-validated) accuracy, and returning that value as <code>bestTune</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">default_knn_mod$bestTune</code></pre></div>
<pre><code>##    k
## 9 17</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">get_best_result =<span class="st"> </span>function(caret_fit) {
  best =<span class="st"> </span><span class="kw">which</span>(<span class="kw">rownames</span>(caret_fit$results) ==<span class="st"> </span><span class="kw">rownames</span>(caret_fit$bestTune))
  best_result =<span class="st"> </span>caret_fit$results[best, ]
  <span class="kw">rownames</span>(best_result) =<span class="st"> </span><span class="ot">NULL</span>
  best_result
}</code></pre></div>
<p>Sometimes it will be useful to obtain the results for only that value. The above function does this automatically.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">get_best_result</span>(default_knn_mod)</code></pre></div>
<pre><code>##    k  Accuracy     Kappa  AccuracySD    KappaSD
## 1 17 0.9720036 0.3803205 0.002404977 0.05972573</code></pre>
<p>While we did fit a large number of models, the “best” model is stored in <code>finalModel</code>. After this model was determined to be the best via cross-validation, it is then fit to the entire training dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">default_knn_mod$finalModel</code></pre></div>
<pre><code>## 17-nearest neighbor classification model
## Training set class distribution:
## 
##   No  Yes 
## 7251  250</code></pre>
<p>With this model, we can again make predictions and obtain predicted probabilities.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">predict</span>(default_knn_mod, <span class="dt">newdata =</span> default_tst, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>))</code></pre></div>
<pre><code>##          No        Yes
## 1 1.0000000 0.00000000
## 2 1.0000000 0.00000000
## 3 1.0000000 0.00000000
## 4 0.9411765 0.05882353
## 5 1.0000000 0.00000000
## 6 1.0000000 0.00000000</code></pre>
<p>As an example of a multi-class response consider the following three models fit to the the <code>iris</code> data. Note that the first model is essentially “multinomial logistic regression,” but you might notice it also has a tuning parameter now. (Spoiler: It’s actually a neural network, so you’ll need the <code>nnet</code> package.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris_log_mod =<span class="st"> </span><span class="kw">train</span>(
  Species ~<span class="st"> </span>.,
  <span class="dt">data =</span> iris,
  <span class="dt">method =</span> <span class="st">&quot;multinom&quot;</span>,
  <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>),
  <span class="dt">trace =</span> <span class="ot">FALSE</span>
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris_knn_mod =<span class="st"> </span><span class="kw">train</span>(
  Species ~<span class="st"> </span>.,
  <span class="dt">data =</span> iris,
  <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>,
  <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>),
  <span class="dt">preProcess =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>),
  <span class="dt">tuneGrid =</span> <span class="kw">expand.grid</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">21</span>, <span class="dt">by =</span> <span class="dv">2</span>))
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris_qda_mod =<span class="st"> </span><span class="kw">train</span>(
  Species ~<span class="st"> </span>.,
  <span class="dt">data =</span> iris,
  <span class="dt">method =</span> <span class="st">&quot;qda&quot;</span>,
  <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>)
)</code></pre></div>
<p>We can obtain predicted probabilities with these three models. Notice that they give the predicted probability for <strong>each</strong> class, using the same syntax for each model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">predict</span>(iris_log_mod, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>))</code></pre></div>
<pre><code>##      setosa  versicolor    virginica
## 1 0.9884905 0.011509549 6.415435e-10
## 2 0.9637873 0.036212696 8.263511e-09
## 3 0.9804027 0.019597292 3.376946e-09
## 4 0.9568631 0.043136865 2.083006e-08
## 5 0.9903391 0.009660933 5.465878e-10
## 6 0.9907892 0.009210789 8.230133e-10</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">predict</span>(iris_knn_mod, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>))</code></pre></div>
<pre><code>##   setosa versicolor virginica
## 1      1          0         0
## 2      1          0         0
## 3      1          0         0
## 4      1          0         0
## 5      1          0         0
## 6      1          0         0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">predict</span>(iris_qda_mod, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>))</code></pre></div>
<pre><code>##   setosa   versicolor    virginica
## 1      1 4.918517e-26 2.981541e-41
## 2      1 7.655808e-19 1.311032e-34
## 3      1 1.552279e-21 3.380440e-36
## 4      1 8.300396e-19 8.541858e-32
## 5      1 3.365614e-27 2.010147e-41
## 6      1 1.472533e-26 1.271928e-40</code></pre>
</div>
</div>
<div id="regression" class="section level2">
<h2><span class="header-section-number">21.2</span> Regression</h2>
<p>To illustrate the use of <code>caret</code> for regression, we’ll consider some simulated data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gen_some_data =<span class="st"> </span>function(<span class="dt">n_obs =</span> <span class="dv">50</span>) {
  x1 =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length.out =</span> n_obs)
  x2 =<span class="st"> </span><span class="kw">runif</span>(<span class="dt">n =</span> n_obs, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">2</span>)
  x3 =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>), <span class="dt">size =</span> n_obs, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
  x4 =<span class="st"> </span><span class="kw">round</span>(<span class="kw">runif</span>(<span class="dt">n =</span> n_obs, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">5</span>), <span class="dv">1</span>)
  x5 =<span class="st"> </span><span class="kw">round</span>(<span class="kw">runif</span>(<span class="dt">n =</span> n_obs, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">5</span>), <span class="dv">0</span>)
  y =<span class="st"> </span><span class="kw">round</span>(x1 ^<span class="st"> </span><span class="dv">2</span> +<span class="st"> </span>x2 ^<span class="st"> </span><span class="dv">2</span> +<span class="st"> </span><span class="dv">2</span> *<span class="st"> </span>(x3 ==<span class="st"> &quot;B&quot;</span>) +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> n_obs), <span class="dv">3</span>)
  <span class="kw">data.frame</span>(y, x1, x2, x3, x4, x5)
}</code></pre></div>
<p>We first simulate a train and test dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">42</span>)
sim_trn =<span class="st"> </span><span class="kw">gen_some_data</span>(<span class="dt">n_obs =</span> <span class="dv">500</span>)
sim_tst =<span class="st"> </span><span class="kw">gen_some_data</span>(<span class="dt">n_obs =</span> <span class="dv">5000</span>)</code></pre></div>
<p>Fitting <code>knn</code> works nearly identically to its use for classification. Really, the only difference here is that we have a numeric response, which <code>caret</code> understands to be a regression problem.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_knn_mod =<span class="st"> </span><span class="kw">train</span>(
  y ~<span class="st"> </span>.,
  <span class="dt">data =</span> sim_trn,
  <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>,
  <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>),
  <span class="co"># preProcess = c(&quot;center&quot;, &quot;scale&quot;),</span>
  <span class="dt">tuneGrid =</span> <span class="kw">expand.grid</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">31</span>, <span class="dt">by =</span> <span class="dv">2</span>))
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_knn_mod$modelType</code></pre></div>
<pre><code>## [1] &quot;Regression&quot;</code></pre>
<p>Notice that we’ve commented out the line to perform pre-processing. Can you figure out why?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">get_best_result</span>(sim_knn_mod)</code></pre></div>
<pre><code>##   k     RMSE  Rsquared      MAE    RMSESD   RsquaredSD     MAESD
## 1 7 3.602252 0.9870044 2.537763 0.1462808 0.0007503021 0.1388759</code></pre>
<p>A few things to notice in the results. In addition to the usual RMSE, which is be used to determine the best model, we also have MAE, the <a href="https://en.wikipedia.org/wiki/Mean_absolute_error">mean absolute error</a>. We are also given standard deviations of both of these metrics.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(sim_knn_mod)</code></pre></div>
<p><img src="21-caret_files/figure-html/unnamed-chunk-35-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The following plot adds error bars to RMSE estimate for each <code>k</code>.</p>
<p><img src="21-caret_files/figure-html/unnamed-chunk-36-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Sometimes, instead of simply picking the model with the best RMSE (or accuracy), we pick the simplest model within one standard error of the model with the best RMSE. Here then, we would consider <code>k = 11</code> instead of <code>k = 7</code> since there isn’t a statistically significant difference. This is potentially a very good idea in practice. By picking a a simpler model, we are essentially at less risk of overfitting, especially since in practice, future data may be slightly different than the data that we are training on. If you’re trying to win a Kaggle competition, this might not be as useful, since often the test and train data come from the exact same source.</p>
<ul>
<li>TODO: additional details about 1-SE rule.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">calc_rmse =<span class="st"> </span>function(actual, predicted) {
  <span class="kw">sqrt</span>(<span class="kw">mean</span>((actual -<span class="st"> </span>predicted) ^<span class="st"> </span><span class="dv">2</span>))
}</code></pre></div>
<p>Since we simulated this data, we have a rather large test dataset. This allows us to compare our cross-validation error estimate, to an estimate using (an impractically large) test set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">get_best_result</span>(sim_knn_mod)$RMSE</code></pre></div>
<pre><code>## [1] 3.602252</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">calc_rmse</span>(<span class="dt">actual =</span> sim_tst$y,
          <span class="dt">predicted =</span> <span class="kw">predict</span>(sim_knn_mod, sim_tst))</code></pre></div>
<pre><code>## [1] 3.446897</code></pre>
<p>Here we see that the cross-validated RMSE is a bit of an overestimate, but still rather close to the test error. The real question is, are either of these any good? Is this model predicting well? No! Notice that we simulated this data with an error standard deviation of 1!</p>
<div id="methods-1" class="section level3">
<h3><span class="header-section-number">21.2.1</span> Methods</h3>
<p>Now that <code>caret</code> has given us a pipeline for a predictive analysis, we can very quickly and easily test new methods. For example, in an upcoming chapter we will discuss boosted tree models, but now that we understand how to use <code>caret</code>, in order to <em>use</em> a boosted tree model, we simply need to know the “method” to do so, which in this case is <code>gbm</code>. Beyond knowing that the method exists, we just need to know its tuning parameters, in this case, there are four. We actually could get away with knowing nothing about them, and simply specify a <code>tuneLength</code>, then <code>caret</code> would automatically try some reasonable values.</p>
<p>Instead, we could <a href="https://topepo.github.io/caret/train-models-by-tag.html">read the <code>caret</code> documentation</a> to find the tuning parameters, as well as the required packages. For now, we’ll simply use the following tuning grid. In later chapters, we’ll discuss how these effect the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gbm_grid =<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">interaction.depth =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),
                       <span class="dt">n.trees =</span> (<span class="dv">1</span>:<span class="dv">30</span>) *<span class="st"> </span><span class="dv">100</span>,
                       <span class="dt">shrinkage =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>),
                       <span class="dt">n.minobsinnode =</span> <span class="dv">20</span>)
<span class="kw">head</span>(gbm_grid)</code></pre></div>
<pre><code>##   interaction.depth n.trees shrinkage n.minobsinnode
## 1                 1     100       0.1             20
## 2                 2     100       0.1             20
## 3                 3     100       0.1             20
## 4                 1     200       0.1             20
## 5                 2     200       0.1             20
## 6                 3     200       0.1             20</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">42</span>)
sim_gbm_mod =<span class="st"> </span><span class="kw">train</span>(
  y ~<span class="st"> </span>.,
  <span class="dt">data =</span> sim_trn,
  <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>),
  <span class="dt">method =</span> <span class="st">&quot;gbm&quot;</span>,
  <span class="dt">tuneGrid =</span> gbm_grid, 
  <span class="dt">verbose =</span> <span class="ot">FALSE</span>
)</code></pre></div>
<p>We added <code>verbose = FALSE</code> to the <code>train()</code> call to suppress some of the intermediate output of the <code>gbm</code> fitting procedure.</p>
<p>How this training is happening is a bit of a mystery to us right now. What is this method? How does it deal with the factor variable as a predictor? We’ll answer these questions later, for now, we do know how to evaluate how well the method is working.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr::<span class="kw">kable</span>(<span class="kw">head</span>(sim_gbm_mod$results), <span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">shrinkage</th>
<th align="right">interaction.depth</th>
<th align="right">n.minobsinnode</th>
<th align="right">n.trees</th>
<th align="right">RMSE</th>
<th align="right">Rsquared</th>
<th align="right">MAE</th>
<th align="right">RMSESD</th>
<th align="right">RsquaredSD</th>
<th align="right">MAESD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">0.1</td>
<td align="right">1</td>
<td align="right">20</td>
<td align="right">100</td>
<td align="right">2.219</td>
<td align="right">0.995</td>
<td align="right">1.654</td>
<td align="right">0.214</td>
<td align="right">0.001</td>
<td align="right">0.128</td>
</tr>
<tr class="even">
<td align="left">91</td>
<td align="right">0.3</td>
<td align="right">1</td>
<td align="right">20</td>
<td align="right">100</td>
<td align="right">2.856</td>
<td align="right">0.991</td>
<td align="right">2.142</td>
<td align="right">0.252</td>
<td align="right">0.002</td>
<td align="right">0.145</td>
</tr>
<tr class="odd">
<td align="left">31</td>
<td align="right">0.1</td>
<td align="right">2</td>
<td align="right">20</td>
<td align="right">100</td>
<td align="right">2.031</td>
<td align="right">0.995</td>
<td align="right">1.424</td>
<td align="right">0.278</td>
<td align="right">0.001</td>
<td align="right">0.174</td>
</tr>
<tr class="even">
<td align="left">121</td>
<td align="right">0.3</td>
<td align="right">2</td>
<td align="right">20</td>
<td align="right">100</td>
<td align="right">2.331</td>
<td align="right">0.994</td>
<td align="right">1.760</td>
<td align="right">0.168</td>
<td align="right">0.001</td>
<td align="right">0.107</td>
</tr>
<tr class="odd">
<td align="left">61</td>
<td align="right">0.1</td>
<td align="right">3</td>
<td align="right">20</td>
<td align="right">100</td>
<td align="right">1.965</td>
<td align="right">0.996</td>
<td align="right">1.382</td>
<td align="right">0.219</td>
<td align="right">0.001</td>
<td align="right">0.134</td>
</tr>
<tr class="even">
<td align="left">151</td>
<td align="right">0.3</td>
<td align="right">3</td>
<td align="right">20</td>
<td align="right">100</td>
<td align="right">2.186</td>
<td align="right">0.995</td>
<td align="right">1.613</td>
<td align="right">0.236</td>
<td align="right">0.001</td>
<td align="right">0.191</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(sim_gbm_mod)</code></pre></div>
<p><img src="21-caret_files/figure-html/unnamed-chunk-43-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_gbm_mod$bestTune</code></pre></div>
<pre><code>##    n.trees interaction.depth shrinkage n.minobsinnode
## 30    3000                 1       0.1             20</code></pre>
<p>Here we obtain the set of tuning parameters that performed best. Based on the above plot, do you think we considered enough possible tuning parameters?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">get_best_result</span>(sim_gbm_mod)</code></pre></div>
<pre><code>##   shrinkage interaction.depth n.minobsinnode n.trees     RMSE  Rsquared
## 1       0.1                 1             20    3000 1.912962 0.9959445
##        MAE    RMSESD RsquaredSD     MAESD
## 1 1.406154 0.1621041 0.00064417 0.1265028</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">calc_rmse</span>(<span class="dt">actual =</span> sim_tst$y,
          <span class="dt">predicted =</span> <span class="kw">predict</span>(sim_gbm_mod, sim_tst))</code></pre></div>
<pre><code>## [1] 1.513519</code></pre>
<p>Again, the cross-validated result is overestimating the error a bit. Also, this model is a big improvement over the <code>knn</code> model, but we can still do better.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_lm_mod =<span class="st"> </span><span class="kw">train</span>(
  y ~<span class="st"> </span><span class="kw">poly</span>(x1, <span class="dv">2</span>) +<span class="st"> </span><span class="kw">poly</span>(x2, <span class="dv">2</span>) +<span class="st"> </span>x3,
  <span class="dt">data =</span> sim_trn,
  <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,
  <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>)
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_lm_mod$finalModel</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = .outcome ~ ., data = dat)
## 
## Coefficients:
##    (Intercept)  `poly(x1, 2)1`  `poly(x1, 2)2`  `poly(x2, 2)1`  
##       34.63954       646.63539       166.47950        26.11496  
## `poly(x2, 2)2`             x3B             x3C  
##        6.77600         1.93871         0.02182</code></pre>
<p>Here we fit a good old linear model, except, we specify a very specific formula.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_lm_mod$results$RMSE</code></pre></div>
<pre><code>## [1] 0.9806239</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">calc_rmse</span>(<span class="dt">actual =</span> sim_tst$y,
          <span class="dt">predicted =</span> <span class="kw">predict</span>(sim_lm_mod, sim_tst))</code></pre></div>
<pre><code>## [1] 1.014825</code></pre>
<p>This model dominates the previous two. The <code>gbm</code> model does still have a big advantage. The <code>lm</code> model needed the correct form of the model, whereas <code>gbm</code> nearly learned it automatically!</p>
<p>This question of <em>which</em> variables should be included is where we will turn our focus next. We’ll consider both what variables are useful for prediction, and learn tools to asses how useful they are.</p>
</div>
</div>
<div id="external-links-4" class="section level2">
<h2><span class="header-section-number">21.3</span> External Links</h2>
<ul>
<li><a href="http://topepo.github.io/caret/index.html">The <code>caret</code> Package</a> - Reference documentation for the <code>caret</code> package in <code>bookdown</code> format.</li>
<li><a href="http://topepo.github.io/caret/available-models.html"><code>caret</code> Model List</a> - List of available models in <code>caret</code>.</li>
<li><a href="https://topepo.github.io/caret/train-models-by-tag.html"><code>caret</code> Model List, By Tag</a> - Gives information on tuning parameters and necessary packages.</li>
<li><a href="http://www.springer.com/us/book/9781461468486">Applied Predictive Modeling</a> - Book from the author of the <code>caret</code> package, Max Kuhn, as well as Kjell Johnson. Further discussion on use of statistical learning methods in practice.</li>
</ul>
</div>
<div id="rmarkdown-10" class="section level2">
<h2><span class="header-section-number">21.4</span> <code>rmarkdown</code></h2>
<p>The <code>rmarkdown</code> file for this chapter can be found <a href="21-caret.Rmd"><strong>here</strong></a>. The file was created using <code>R</code> version 3.4.2.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="resampling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="subset-selection.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/daviddalpiaz/r4sl/edit/master/21-caret.Rmd",
"text": "Edit"
},
"download": ["r4sl.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
